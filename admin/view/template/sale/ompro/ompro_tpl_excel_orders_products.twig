{{ header }}
<div class="content-wrapper" id="content-omanager">

<link rel="stylesheet" type="text/css" href="view/javascript/ompro/codemirror/lib/codemirror.css"/>
<script type="text/javascript" src="view/javascript/ompro/codemirror/lib/codemirror.js"></script>
<script type="text/javascript" src="view/javascript/ompro/codemirror/addon/matchbrackets.js"></script>
<script type="text/javascript" src="view/javascript/ompro/codemirror/addon/autorefresh.js"></script>
<script type="text/javascript" src="view/javascript/ompro/codemirror/mode/xml.js"></script>
<script type="text/javascript" src="view/javascript/ompro/codemirror/mode/css.js"></script>
<script type="text/javascript" src="view/javascript/ompro/codemirror/mode/javascript.js"></script>
<link rel="stylesheet" type="text/css" href="view/javascript/ompro/codemirror/theme/rubyblue.css"/>

<script type="text/javascript" src="view/javascript/ompro/jscolor.js"></script>
<script src="view/javascript/ompro/Sortable.js"></script>

<section class="content-header">
  <h1>
	{{ heading_title }}
	<small>{{ heading_template_edit }}</small>
  </h1>
  <ol class="breadcrumb">
	{% for breadcrumb in breadcrumbs %}
		{{ breadcrumb }}
	{% endfor %}
  </ol>
</section>

<section class="content">
<form action="{{ action }}" method="post" enctype="multipart/form-data" id="form" class="form-horizontal">
  <div class="box">

	<div class="box-header with-border">
		<div class="row">
		  <div class="col-sm-10 box-tools pull-left">
			<div class="col-sm-5">
			  <div class="form-group valid-block">
				<span class="input-group">
					<div class="input-group-addon" data-toggle="tooltip" title="{{ text_code }}">{{ text_tpl_code }}</div>
					<div class="input-group-addon" data-toggle="tooltip" title="{{ entry_template_name }}"><i class="fa fa-text-width"></i></div>
					<input type="text" id="input-name" name="template[name]" value="{{ template['name'] is defined ? template['name'] : text_new_template }}" class="field-input mustbe form-control" />
				</span>
			  </div>
			</div>
			<div class="col-sm-7">
			  <div class="form-group">
				<span class="input-group">
					<div class="input-group-addon" data-toggle="tooltip" title="{{ entry_template_description }}"><i class="fa fa-info"></i></div>
					<textarea name="template[description]" id="input-description" rows="1" class="form-control">{{ template['description'] is defined ? template['description'] : '' }}</textarea>
				</span>
			  </div>
			</div>
		  </div>
		  <div class="col-sm-2 box-tools pull-right text-right">
			<a id="button_save" class="btn btn-primary"><i class="fa fa-save"></i>&nbsp;&nbsp;{{ button_save }}</a>
			<a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a>
		  </div>
		</div>
	</div>

	<div class="box-body">
		<div class="nav-tabs-custom">
		  <ul class="nav nav-tabs" id="nav-tabs">
            <li><a href="#tab-columns" data-toggle="tab">{{ tab_template_columns }}</a></li>
            <li><a href="#tab-total" data-toggle="tab">{{ tab_template_total }}</a></li>
			<li><a href="#tab_backup" data-toggle="tab"><i class="fa fa-database"></i>&nbsp;&nbsp;{{ text_tab_backup }}</a></li>
          </ul>

		  <div class="tab-content">
            <div class="tab-pane" id="tab-columns">
			  <div class="panel-group">
				  <div class="callout callout-default">
					<p><a class="btn btn-info btn-xs" style="text-decoration: none;" href="http://brest001.ru/ompro_doc/ompro_tpl_excel_orders_products.html"  target="_blank" data-toggle="tooltip" title="{{ text_doc_link }}" ><i class="fa fa-question-circle"></i>&nbsp;&nbsp; {{ text_help }}</a>&nbsp;&nbsp; {{ entry_excel_vars_info }}</p>
				  </div>
				  <div class="panel panel-default">
					<div class="panel-body">
						<div class="row">
						  <label class="col-sm-2 control-label">{{ entry_excel_preview }}</label>
						  <div class="col-sm-10 valid-block">
							<div class="input-group">
							  <span class="input-group-addon" data-toggle="tooltip" title="{{ entry_select_multi_orders }}">&nbsp;<i class="fa fa-shopping-cart"></i>&nbsp;</span>
							  <span class="input-group-addon" data-toggle="tooltip" title="{{ entry_print_select_last_order_help }}">&nbsp;<i class="fa fa-info text-blue"></i>&nbsp;</span>
							  <input type="text"  value="{{ last_order }}" id="test-order-id" class="field-input digitovercoma form-control" placeholder="{{ entry_select_last_order_placeholder }}"/>
							  <span class="input-group-btn">
								<a id="export-preview" data-toggle="tooltip" title="" class="btn btn-primary"><i class="fa fa-file-excel-o"></i>&nbsp;&nbsp;{{ button_excel_preview }}</a>
							  </span>
							</div>
						  </div>
					  </div>
					</div>
				  </div>

				  <div class="panel panel-default">
					<div class="panel-body">
					  <div class="row">
						<label class="col-sm-2 control-label">{{ entry_col_widths }}</label>
						<div class="col-sm-4">
							<div class="input-group valid-block">
							   <span class="input-group-addon" data-toggle="tooltip" title="{{ entry_col_widths_info }}">&nbsp;<i class="fa fa-info text-blue"></i>&nbsp;</span>
							  <input type="text" name="template[col_widths]" value="{{ template['col_widths'] is defined ? template['col_widths'] : '' }}" class="field-input digitovercomanotmustbe form-control" placeholder="20,40,50,40"/>
							</div>
						</div>
						<div class="col-sm-2">
						  <div class="radio">
							<label>{{ entry_product_group_by }} &nbsp;&nbsp;<i class="fa fa-info-circle text-blue" data-toggle="tooltip" title="{{ entry_product_group_by_info }}"></i></label>&nbsp;&nbsp;
						  </div>
						</div>
						<div class="col-sm-4">
							<select name="template[product_group_by]" class="form-control">
							{% for group_by_value,group_by_text in product_group_by_list %} 
								<option value="{{ group_by_value }}" {% if (template['product_group_by'] is defined and template['product_group_by'] == group_by_value) %} selected="selected"{% endif %}>{{ group_by_text }}</option>
							{% endfor %} 
							</select>
						</div>
					  </div>
					</div>
				  </div>

				  {% for key,text in row_list %}

				  <div class="panel panel-default">
					<div class="panel-heading"><a data-toggle="collapse" href="#set-{{ key }}-rows"><i class="fa fa-sort text-blue"></i>&nbsp;&nbsp; {{ text }}</a></div>
					<div id="set-{{ key }}-rows" class="panel-collapse collapse">
					  <div class="panel-body">

						<div id="{{ key }}-row-group" class="panel-group">
							{% if (key == 'header' or key == 'footer') %}
							  <div class="callout callout-default">
								<p><i class="fa fa-exclamation-triangle text-blue"></i>&nbsp; {{ entry_excel_header_footer_info }}</p>
							  </div>
							 {% endif %}

						  {% set i_row = 1 %}
						  {% if (template[key] is not empty) %}
						  {% for row in template[key] %}

							<div class="panel panel-default {{ key }}-row-panel">
							  <div class="panel-heading">
								<div class="valid-block">
								  <div class="input-group">
									<span class="input-group-addon">
										<i class="fa fa-arrows handle handle-row" data-toggle="tooltip" title="{{ text_moove_to_sort }}"></i>&nbsp;&nbsp; <a data-toggle="collapse" href="#set-{{ key ~ i_row }}"><i class="fa fa-sort text-blue"></i>&nbsp;&nbsp; {{ text_row ~ i_row }}</a>
									</span>
									<span class="input-group-addon">{{ text_row_type }}</span>
									<span class="input-group-addon" data-toggle="tooltip" title="{{ text_row_type_info }}"><i class="fa fa-info text-blue"></i></span>
									<select name="template[{{ key }}][{{ i_row }}][type]" class="form-control" >
										<option value="title" {% if (row['type'] is defined and row['type'] == 'title') %} selected="selected"{% endif %}>{{ text_row_type_title }}</option>
										<option value="data" {% if (row['type'] is defined and row['type'] == 'data') %} selected="selected"{% endif %}>{{ text_row_type_data }}</option>
									</select>
									<span class="input-group-addon">{{ text_row_height }}</span>
									<span class="input-group-addon" data-toggle="tooltip" title="{{ text_row_height_info }}"><i class="fa fa-info text-blue"></i></span>
									<input type="text" name="template[{{ key }}][{{ i_row }}][height]" value="{{ row['height'] is defined ? row['height'] : 20 }}" class="field-input numeric form-control" placeholder="20"/>
									<div class="input-group-btn">
										<a onclick="$(this).closest('.{{ key }}-row-panel').remove(); tooltipRefresh();"  class="btn btn-danger" data-toggle="tooltip" title="{{ button_remove_row }}"><i class="fa fa-minus-circle"></i></a>
									</div>
								  </div>
								</div>
							  </div>

							  <div id="set-{{ key ~ i_row }}" class="panel-collapse collapse">
								<div class="panel-body">
								<div class="table-responsive">
								  <table class="table table-bordered table-striped {{ key }}-col-table" id="{{ key }}-col-table{{ i_row }}">
									<thead>
										<tr class="">
											<th class="text-center" style="width: 1%;">#</th>
											<th style="min-width: 180px;">{{ text_column_format }}</th>
											<th style="min-width: 200px;">{{ text_column_format_param }}</th>
											<th style="min-width: 60px;"><i class="fa fa-clone"></i>&nbsp;&nbsp;<i class="fa fa-info-circle text-blue" data-toggle="tooltip" title="{{ text_column_merge }}"></i></th>
											<th style="min-width: 185px; width: 185px;">{{ text_column_align }}&nbsp;&nbsp;<i class="fa fa-info-circle text-blue" data-toggle="tooltip" title="{{ text_column_align_info }}"></i></th>
											<th style="min-width: 400px;">{{ text_column_value }}
											{% if (key == 'order' or key == 'product') %}
											&nbsp;&nbsp;&nbsp;<a onclick="getTableCodes('{{ key }}');" style="font-weight: normal; cursor: pointer;">{{ text_table_fields_codes }}</a>
											{% endif %}
											</th>
											<th style="width: ">{{ text_column_style }}</th>
											<th style="width: 60px;"></th>
										</tr>
									</thead>
									<tbody class="tbody-sortable">
									  {% set i_col = 1 %}
									  {% if (row['columns'] is not empty) %}
										{% for column in row['columns'] %}
										<tr id="{{ key }}-col-table-row{{ i_row~'_'~i_col }}" class="col-table-row">
											<td class="text-center handle handle-col" data-toggle="tooltip" title="{{ text_moove_to_sort }}"><i class="fa fa-arrows"></i><br/>{{ i_col }}</td>
											<td>
												<select name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][format]" class="select-col-format form-control" data-key="{{ key }}" data-i_row="{{ i_row }}" data-i_col="{{ i_col }}">
												  {% for format,format_name in col_format_list %}
													<option value="{{ format }}" {% if (column['format'] is defined and column['format'] == format) %} selected="selected"{% endif %}>{{ format_name }}</option>
												  {% endfor %}
												</select>
											</td>
											<td id="format_add_{{ key }}_{{ i_row }}_{{ i_col }}">
												{% if (column['format'] is defined and column['format'] == 'link') %}
												  <div class="input-group">
													<span class="input-group-addon" data-toggle="tooltip" title="{{ text_col_link_text }}"><i class="fa fa-text-width"></i></span>
													<textarea name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][text]" rows="1" class="htmlTextArea form-control"  style="min-width: 200px;">{{ column['text'] is defined ? column['text'] : '' }}</textarea>
												  </div>
												{% endif %}
												{% if (column['format'] is defined and column['format'] == 'image') %}
												  <div class="input-group">
													  <span class="input-group-addon" data-toggle="tooltip" title="{{ text_col_img_size }}"><i class="fa fa-image"></i></span>
													  <input type="text" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][img_width]" value="{{ column['img_width'] is defined ? column['img_width'] : 50 }}" class="field-input numericmustbe form-control" />
													  <span class="input-group-addon">x</span>
													  <input type="text" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][img_height]" value="{{ column['img_height'] is defined ? column['img_height'] : 50 }}" class="field-input numericmustbe form-control"  />
												  </div>
												{% endif %}
											</td>
											<td>
												<input type="text" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][merge]" value="{{ column['merge'] is defined ? column['merge'] : 1 }}" class="field-input numericmustbe form-control" placeholder="1" />
											</td>
											<td>
												<div class="btn-group btn-group-justified btn-group-xs" data-toggle="buttons">
													<label class="btn btn-default {% if (column['alignment']['horizomtal'] is defined and column['alignment']['horizomtal'] == 'left') %}active{% endif %}" data-toggle="tooltip" title="{{ text_align_hor_left }}"><input type="radio" value="left" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][alignment][horizomtal]" {% if (column['alignment']['horizomtal'] is defined and column['alignment']['horizomtal'] == 'left') %}checked{% endif %} /><i class="fa fa-align-left"></i></label>
													<label class="btn btn-default {% if (column['alignment']['horizomtal'] is not defined or column['alignment']['horizomtal'] is defined and column['alignment']['horizomtal'] == 'center') %}active{% endif %}" data-toggle="tooltip" title="{{ text_align_hor_center }}"><input type="radio" value="center" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][alignment][horizomtal]" {% if (column['alignment']['horizomtal'] is defined and column['alignment']['horizomtal'] == 'center') %}checked{% endif %} /><i class="fa fa-align-center"></i></label>
													<label class="btn btn-default {% if (column['alignment']['horizomtal'] is defined and column['alignment']['horizomtal'] == 'right') %}active{% endif %}" data-toggle="tooltip" title="{{ text_align_hor_right }}"><input type="radio" value="right" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][alignment][horizomtal]" {% if (column['alignment']['horizomtal'] is defined and column['alignment']['horizomtal'] == 'right') %}checked{% endif %} /><i class="fa fa-align-right"></i></label>
													<label class="btn btn-default {% if (column['alignment']['horizomtal'] is defined and column['alignment']['horizomtal'] == 'justify') %}active{% endif %}" data-toggle="tooltip" title="{{ text_align_hor_justify }}"><input type="radio" value="justify" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][alignment][horizomtal]" {% if (column['alignment']['horizomtal'] is defined and column['alignment']['horizomtal'] == 'justify') %}checked{% endif %} /><i class="fa fa-align-justify"></i></label>
													<label class="btn btn-default {% if (column['alignment']['horizomtal'] is defined and column['alignment']['horizomtal'] == 'distributed') %}active{% endif %}" data-toggle="tooltip" title="{{ text_align_hor_distributed }}"><input type="radio" value="distributed" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][alignment][horizomtal]" {% if (column['alignment']['horizomtal'] is defined and column['alignment']['horizomtal'] == 'distributed') %}checked{% endif %} /><i class="fa fa-exchange"></i></label>
												</div>
												<div class="btn-group btn-group-justified btn-group-xs" data-toggle="buttons">
													<label class="btn btn-default {% if (column['alignment']['vertical'] is defined and column['alignment']['vertical'] == 'top') %}active{% endif %}" data-toggle="tooltip" title="{{ text_align_ver_top }}"><input type="radio" value="top" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][alignment][vertical]" {% if (column['alignment']['vertical'] is defined and column['alignment']['vertical'] == 'top') %}checked{% endif %} /><i class="fa fa-hourglass-start"></i></label>
													<label class="btn btn-default {% if (column['alignment']['vertical'] is not defined or column['alignment']['vertical'] is defined and column['alignment']['vertical'] == 'center') %}active{% endif %}" data-toggle="tooltip" title="{{ text_align_ver_center }}"><input type="radio" value="center" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][alignment][vertical]" {% if (column['alignment']['vertical'] is defined and column['alignment']['vertical'] == 'center') %}checked{% endif %} /><i class="fa fa-hourglass-o"></i></label>
													<label class="btn btn-default {% if (column['alignment']['vertical'] is defined and column['alignment']['vertical'] == 'bottom') %}active{% endif %}" data-toggle="tooltip" title="{{ text_align_ver_bottom }}"><input type="radio" value="bottom" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][alignment][vertical]" {% if (column['alignment']['vertical'] is defined and column['alignment']['vertical'] == 'bottom') %}checked{% endif %} /><i class="fa fa-hourglass-end"></i></label>
													<label class="btn btn-default {% if (column['alignment']['vertical'] is defined and column['alignment']['vertical'] == 'justify') %}active{% endif %}" data-toggle="tooltip" title="{{ text_align_ver_justify }}"><input type="radio" value="justify" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][alignment][vertical]" {% if (column['alignment']['vertical'] is defined and column['alignment']['vertical'] == 'justify') %}checked{% endif %} /><i class="fa fa-hourglass"></i></label>
													<label class="btn btn-default {% if (column['alignment']['vertical'] is defined and column['alignment']['vertical'] == 'distributed') %}active{% endif %}" data-toggle="tooltip" title="{{ text_align_ver_distributed }}"><input type="radio" value="distributed" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][alignment][vertical]" {% if (column['alignment']['vertical'] is defined and column['alignment']['vertical'] == 'distributed') %}checked{% endif %} /><i class="fa fa-hourglass-2"></i></label>
												</div>
											</td>
											<td>
												<textarea name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][value]" rows="1" class="htmlTextArea form-control"  style="min-width: 200px;">{{ column['value'] is defined ? column['value'] : '' }}</textarea>
											</td>
											<td id="style_{{ key }}_{{ i_row }}_{{ i_col }}">
												{% if (column['style'] is not empty) %}
												  <div class="input-group">
													<div class="input-group-btn"><a onclick="toggleStyle('remove','{{ key }}','{{ i_row }}','{{ i_col }}');" class="btn btn-default" data-toggle="tooltip" title="{{ btn_remove_style }}"><i class="fa fa-times-circle"></i></a></div>
													<span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_font }}"><i class="fa fa-font"></i></span>
													<select name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][style][font][name]" class="form-control" style="min-width: 160px;">
													  {% for font in font_list %}
														<option value="{{ font }}" {% if (column['style']['font']['name'] is defined and column['style']['font']['name'] == font) %} selected="selected"{% endif %}>{{ font }}</option>
													  {% endfor %}
													</select>
													<span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_font_size }}"><i class="fa fa-text-height"></i></span>
													<input type="text" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][style][font][size]" value="{{ column['style']['font']['size'] is defined ? column['style']['font']['size'] : 10 }}" class="field-input numericmustbe form-control" placeholder="10" style="min-width: 40px;" />
													<span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_font_color }}"><i class="fa fa-adjust"></i></span>
													<input type="text" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][style][font][color][rgb]" value="{{ column['style']['font']['color'] is defined and column['style']['font']['color']['rgb'] is defined ? column['style']['font']['color']['rgb'] : '000000' }}" class="form-control jscolor {mode:'HVS',position:'right'}" style="min-width: 70px;" />

													<div class="input-group-btn" data-toggle="buttons">
														<label class="btn btn-default {% if (column['style']['font']['bold'] is defined and column['style']['font']['bold'] == 1) %}active{% endif %}" data-toggle="tooltip" title="{{ text_style_title_font_bold }}"><input type="checkbox" value="1" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][style][font][bold]" {% if (column['style']['font']['bold'] is defined and column['style']['font']['bold'] == 1) %} checked{% endif %} /><i class="fa fa-bold"></i></label>
														<label class="btn btn-default {% if (column['style']['font']['italic'] is defined and column['style']['font']['italic'] == 1) %}active{% endif %}" data-toggle="tooltip" title="{{ text_style_title_font_italic }}"><input type="checkbox" value="1" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][style][font][italic]" {% if (column['style']['font']['italic'] is defined and column['style']['font']['italic'] == 1) %}checked{% endif %} /><i class="fa fa-italic"></i></label>
														<label class="btn btn-default {% if (column['style']['font']['underline'] is defined and column['style']['font']['underline'] == 1) %}active{% endif %}" data-toggle="tooltip" title="{{ text_style_title_font_underline }}"><input type="checkbox" value="1" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][style][font][underline]" {% if (column['style']['font']['underline'] is defined and column['style']['font']['underline'] == 1) %}checked{% endif %} /><i class="fa fa-underline"></i></label>
														<label class="btn btn-default {% if (column['style']['font']['strike'] is defined and column['style']['font']['strike'] == 1) %}active{% endif %}" data-toggle="tooltip" title="{{ text_style_title_font_strike }}"><input type="checkbox" value="1" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][style][font][strike]" {% if (column['style']['font']['strike'] is defined and column['style']['font']['strike'] == 1) %}checked{% endif %} /><i class="fa fa-strikethrough"></i></label>
													</div>

													<span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_font_fill }}"><i class="fa fa-circle"></i></span>
													<input type="text" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][style][fill][color][rgb]" value="{{ column['style']['fill']['color'] is defined and column['style']['fill']['color']['rgb'] is defined ? column['style']['fill']['color']['rgb'] : 'ffffff' }}" class="form-control jscolor {mode:'HVS',position:'right'}" style="min-width: 70px;" />
													<input type="hidden" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][style][fill][type]" value="solid" />

													<span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_border_style }}"><i class="fa fa-square-o"></i></span>
													<select name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][style][borders][allborders][style]" class="form-control" style="min-width: 80px;">
													  {% for style in border_style_list %}
														<option value="{{ style }}" {% if (column['style']['borders']['allborders']['style'] is defined and column['style']['borders']['allborders']['style'] == style) %} selected="selected"{% endif %}>{{ style }}</option>
													  {% endfor %}
													</select>
													<span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_border_color }}"><i class="fa fa-square"></i></span>
													<input type="text" name="template[{{ key }}][{{ i_row }}][columns][{{ i_col }}][style][borders][allborders][color][rgb]" value="{{ column['style']['borders']['allborders']['color'] is defined and column['style']['borders']['allborders']['color']['rgb'] is defined ? column['style']['borders']['allborders']['color']['rgb'] : '000000' }}" class="form-control jscolor {mode:'HVS',position:'right'}" style="min-width: 70px;" />
												  </div>
												{% else %}
												  <a onclick="toggleStyle('add','{{ key }}','{{ i_row }}','{{ i_col }}');" class="btn btn-primary" data-toggle="tooltip" title="{{ btn_add_style }}"><i class="fa fa-plus-circle"></i></a>
												{% endif %}
											</td>
											<td><a onclick="$(this).closest('.col-table-row').remove(); tooltipRefresh();"  class="btn btn-danger" data-toggle="tooltip" title="{{ button_remove_row }}"><i class="fa fa-minus-circle"></i></a></td>
										</tr>
										{% set i_col = i_col + 1 %}
										{% endfor %}
									  {% endif %}
									</tbody>
									<tfoot>
										<tr class="active">
											<td></td>
											<td colspan="7"><a onclick="addRowColumn('{{ key }}','{{ i_row }}','{{ i_col }}');" class="btn btn-primary add-column-row" data-toggle="tooltip" title="{{ button_add_column }}"><i class="fa fa-plus"></i></a></td>
										</tr>
									</tfoot>
								  </table>
								</div>
							  </div>
							  </div>
							</div>

							{% set i_row = i_row + 1 %}
						  {% endfor %}
						  {% endif %}
							<div class="panel panel-default add-row-panel">
								<div class="panel-body">
									<a onclick="addRow('{{ key }}','{{ i_row }}');" class="btn btn-success add-row"><i class="fa fa-plus"></i> {{ button_add_row }}</a>
								</div>
							</div>
							{% if (key == 'order') %}
							  <div class="panel panel-default">
								<div class="panel-heading"><a data-toggle="collapse" href="#set-total"><i class="fa fa-sort text-blue"></i>&nbsp;&nbsp; {{ entry_order_totals_heading }}</a></div>
								<div id="set-total" class="panel-collapse collapse">
									<div class="panel-body">
									  <div class="form-group">
										<label class="col-sm-3 control-label">
											<p>{{ entry_order_totals_template }}&nbsp;&nbsp;<i data-toggle="tooltip" title="{{ entry_order_totals_template_help }}" class="fa fa-question-circle text-danger"></i>&nbsp;&nbsp;<i data-toggle="tooltip" title="{{ entry_order_totals_template_hel2_excel }}" class="fa fa-question-circle text-primary"></i></p>
										</label>
										<div class="col-sm-9">
										  <textarea name="template[total_tpl]" rows="6" class="form-control htmlTextArea">{{ template['total_tpl'] is defined ? template['total_tpl'] : "{total_name}: {total_value}\n" }}</textarea>
										</div>
									  </div>
									</div>
								</div>
							  </div>
							{% endif %}
							{% if (key == 'product') %}
							  <div class="panel panel-default">
								<div class="panel-heading"><a data-toggle="collapse" href="#set-option"><i class="fa fa-sort text-blue"></i>&nbsp;&nbsp; {{ entry_option_heading }}</a></div>
								<div id="set-option" class="panel-collapse collapse">
									<div class="panel-body">
									  <div class="form-group">
										<label class="col-sm-3 control-label">
											<p>{{ entry_option_tpl }}&nbsp;&nbsp;<i data-toggle="tooltip" title="{{ entry_option_tpl_help }}" class="fa fa-question-circle text-danger"></i>&nbsp;&nbsp;<i data-toggle="tooltip" title="{{ entry_option_tpl_help2_excel }}" class="fa fa-question-circle text-primary"></i></p>
										</label>
										<div class="col-sm-9">
										  <textarea name="template[option_tpl]" rows="6" class="form-control htmlTextArea">{{ template['option_tpl'] is defined ? template['option_tpl'] : "{option_name}: {option_value} [[(остаток: {option_quantity} шт.)]]\n" }}</textarea>
										</div>
									  </div>
									</div>
								</div>
							  </div>

							  <div class="panel panel-default">
								<div class="panel-heading"><a data-toggle="collapse" href="#set-attribute"><i class="fa fa-sort text-blue"></i>&nbsp;&nbsp; {{ entry_attribute_heading }}</a></div>
								<div id="set-attribute" class="panel-collapse collapse">
									<div class="panel-body">
									  <div class="form-group">
										<label class="col-sm-3 control-label">
											<p>{{ entry_attribute_group_tpl }}&nbsp;&nbsp;<i data-toggle="tooltip" title="{{ entry_attribute_group_tpl_help }}" class="fa fa-question-circle text-danger"></i>&nbsp;&nbsp;<i data-toggle="tooltip" title="{{ entry_attribute_group_tpl_help2 }}" class="fa fa-question-circle text-primary"></i></p>
										</label>
										<div class="col-sm-9">
										  <textarea name="template[attribute_group_tpl]" rows="6" class="form-control htmlTextArea">{{ template['attribute_group_tpl'] is defined ? template['attribute_group_tpl'] : "{attribute_group_name}: \n[[{attribute}]]\n" }}</textarea>
										</div>
									  </div>
									  <div class="form-group">
										<label class="col-sm-3 control-label">
											<p>{{ entry_attribute_tpl }}&nbsp;&nbsp;<i data-toggle="tooltip" title="{{ entry_attribute_tpl_help2_excel }}" class="fa fa-question-circle text-primary"></i></p>
										</label>
										<div class="col-sm-9">
										  <textarea name="template[attribute_tpl]" rows="6" class="form-control htmlTextArea">{{ template['attribute_tpl'] is defined ? template['attribute_tpl'] : "{attribute_name}: {attribute_value}; " }}</textarea>
										</div>
									  </div>
									</div>
								</div>
							  </div>
							{% endif %}
						</div>

					  </div>
					</div>
				  </div>
				  {% endfor %}
			  </div>
			</div>

			<div class="tab-pane" id="tab-total">
			  <div class="row">
				<div class="col-sm-12">
				  <div class="callout callout-default">
					<p><a class="btn btn-info btn-xs" style="text-decoration: none;" href="http://brest001.ru/ompro_doc/ompro_tpl_excel_orders_products.html"  target="_blank" data-toggle="tooltip" title="{{ text_doc_link }}" ><i class="fa fa-question-circle"></i>&nbsp;&nbsp; {{ text_help }}</a>&nbsp;&nbsp; {{ entry_excel_total_info }}</p>
				  </div>
				</div>
			  </div>

			  <div class="form-group">
				<div class="col-lg-3">
					<label class="control-label">{{ entry_excel_default_store }}&nbsp;&nbsp;<i data-toggle="tooltip" title="{{ entry_excel_default_store_info }}" class="fa fa-question-circle text-primary"></i></label>
					<div class="input-group">
						<span class="input-group-addon"><i class="fa fa-shopping-cart"></i></span>
						<select name="template[default_store_id]" class="form-control" style="min-width: 160px;">
						  {% for store in stores %}
							<option value="{{ store['id'] }}" {% if (template['default_store_id'] is defined and template['default_store_id'] == store['id']) %} selected="selected"{% endif %}>{{ store['text'] }}</option>
						  {% endfor %}
						</select>
					</div>
				</div>
				<div class="col-lg-3">
					<label class="control-label">{{ entry_excel_sheet_name }}</label>
					<div class="input-group valid-block">
						<span class="input-group-addon"><i class="fa fa-file-excel-o"></i></span>
						<input type="text" name="template[sheet_name]" value="{{ template['sheet_name'] is defined ? template['sheet_name'] : entry_excel_sheet_name }}" class="field-input mustbe form-control" placeholder="{{ entry_excel_sheet_name }}" />
					</div>
				</div>
				<div class="col-lg-6">
				  <label class="control-label">{{ entry_excel_default_font }}</label>
					<div class="input-group">
						<span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_font }}"><i class="fa fa-font"></i></span>
						<select name="template[default_font][name]" class="form-control" style="min-width: 160px;">
						  {% for font in font_list %}
							<option value="{{ font }}" {% if (template['default_font']['name'] is defined and template['default_font']['name'] == font) %} selected="selected"{% endif %}>{{ font }}</option>
						  {% endfor %}
						</select>
						<span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_font_size }}"><i class="fa fa-text-height"></i></span>
						<input type="text" name="template[default_font][size]" value="{{ template['default_font']['size'] is defined ? template['default_font']['size'] : 10 }}" class="field-input numericmustbe form-control" placeholder="10" style="min-width: 40px;" />
					</div>
				</div>
			  </div>

			  <div class="panel-group">
				<div class="panel panel-default">
				  <div class="panel-heading"><b>{{ entry_default_cell_set }}</b></div>
				  <div class="panel-body">

					<div class="table-responsive">
					  <table class="table table-bordered table-striped {{ key }}-col-table" id="{{ key }}-col-table{{ i_row }}">
						<thead>
							<tr>
								<th style="width: 180px;">{{ text_column_type }}</th>
								<th style="width: ">{{ text_column_style }}</th>
							</tr>
						</thead>
						<tbody>
						  {% for set,title in default_set_col_list %}
							<tr>
								<td>{{ title }} {% if (set == 'default_set_col_img') %}&nbsp;&nbsp;<i data-toggle="tooltip" title="{{ text_default_set_col_img_info }}" class="fa fa-question-circle text-primary"></i>&nbsp;&nbsp;<i data-toggle="tooltip" title="{{ text_default_set_col_img_info2 }}" class="fa fa-question-circle text-red"></i>{% endif %}
								</td>
								<td>
								  <div class="input-group">
									<span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_font }}"><i class="fa fa-font"></i></span>
									<select name="template[{{ set }}][style][font][name]" class="form-control" style="min-width: 160px;">
									  {% for font in font_list %}
										<option value="{{ font }}" {% if (template[set]['style']['font']['name'] is defined and template[set]['style']['font']['name'] == font) %} selected="selected"{% endif %}>{{ font }}</option>
									  {% endfor %}
									</select>
									<span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_font_size }}"><i class="fa fa-text-height"></i></span>
									<input type="text" name="template[{{ set }}][style][font][size]" value="{{ template[set]['style']['font']['size'] is defined ? template[set]['style']['font']['size'] : 10 }}" class="field-input numericmustbe form-control" placeholder="10" style="min-width: 40px;" />
									<span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_font_color }}"><i class="fa fa-adjust"></i></span>
									<input type="text" name="template[{{ set }}][style][font][color][rgb]" value="{{ template[set]['style']['font']['color'] is defined and template[set]['style']['font']['color']['rgb'] is defined ? template[set]['style']['font']['color']['rgb'] : '000000' }}" class="form-control jscolor {mode:'HVS',position:'right'}" style="min-width: 70px;" />

									<div class="input-group-btn" data-toggle="buttons">
										<label class="btn btn-default {% if (template[set]['style']['font']['bold'] is defined and template[set]['style']['font']['bold'] == 1) %}active{% endif %}" data-toggle="tooltip" title="{{ text_style_title_font_bold }}"><input type="checkbox" value="1" name="template[{{ set }}][style][font][bold]" {% if (template[set]['style']['font']['bold'] is defined and template[set]['style']['font']['bold'] == 1) %} checked{% endif %} /><i class="fa fa-bold"></i></label>
										<label class="btn btn-default {% if (template[set]['style']['font']['italic'] is defined and template[set]['style']['font']['italic'] == 1) %}active{% endif %}" data-toggle="tooltip" title="{{ text_style_title_font_italic }}"><input type="checkbox" value="1" name="template[{{ set }}][style][font][italic]" {% if (template[set]['style']['font']['italic'] is defined and template[set]['style']['font']['italic'] == 1) %}checked{% endif %} /><i class="fa fa-italic"></i></label>
										<label class="btn btn-default {% if (template[set]['style']['font']['underline'] is defined and template[set]['style']['font']['underline'] == 1) %}active{% endif %}" data-toggle="tooltip" title="{{ text_style_title_font_underline }}"><input type="checkbox" value="1" name="template[{{ set }}][style][font][underline]" {% if (template[set]['style']['font']['underline'] is defined and template[set]['style']['font']['underline'] == 1) %}checked{% endif %} /><i class="fa fa-underline"></i></label>
										<label class="btn btn-default {% if (template[set]['style']['font']['strike'] is defined and template[set]['style']['font']['strike'] == 1) %}active{% endif %}" data-toggle="tooltip" title="{{ text_style_title_font_strike }}"><input type="checkbox" value="1" name="template[{{ set }}][style][font][strike]" {% if (template[set]['style']['font']['strike'] is defined and template[set]['style']['font']['strike'] == 1) %}checked{% endif %} /><i class="fa fa-strikethrough"></i></label>
									</div>

									<span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_font_fill }}"><i class="fa fa-circle"></i></span>
									<input type="text" name="template[{{ set }}][style][fill][color][rgb]" value="{{ template[set]['style']['fill']['color'] is defined and template[set]['style']['fill']['color']['rgb'] is defined ? template[set]['style']['fill']['color']['rgb'] : 'ffffff' }}" class="form-control jscolor {mode:'HVS',position:'right'}" style="min-width: 70px;" />
									<input type="hidden" name="template[{{ set }}][style][fill][type]" value="solid" />

									<span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_border_style }}"><i class="fa fa-square-o"></i></span>
									<select name="template[{{ set }}][style][borders][allborders][style]" class="form-control" style="min-width: 80px;">
									  {% for style in border_style_list %}
										<option value="{{ style }}" {% if (template[set]['style']['borders']['allborders']['style'] is defined and template[set]['style']['borders']['allborders']['style'] == style) %} selected="selected"{% endif %}>{{ style }}</option>
									  {% endfor %}
									</select>
									<span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_border_color }}"><i class="fa fa-square"></i></span>
									<input type="text" name="template[{{ set }}][style][borders][allborders][color][rgb]" value="{{ template[set]['style']['borders']['allborders']['color'] is defined and template[set]['style']['borders']['allborders']['color']['rgb'] is defined ? template[set]['style']['borders']['allborders']['color']['rgb'] : '000000' }}" class="form-control jscolor {mode:'HVS',position:'right'}" style="min-width: 70px;" />
								  </div>
								</td>
							</tr>
						  {% endfor %}
						</tbody>
					  </table>
					</div>
				  </div>
				</div>
			  </div>
			</div>

			<div class="tab-pane" id="tab_backup">
				<div class="callout callout-default">
					<p><i class="fa fa-exclamation-triangle text-blue"></i> {{ text_tab_backup_help }}</p>
				</div>
				<div class="panel panel-default">
				  <div class="panel-body">
					<div class="row" style="margin-bottom: 15px;">
						<label class="col-sm-2 control-label text-right">{{ entry_save_to_file }}</label>
						<div class="col-sm-10">
						  <a class="btn btn-primary" target="_blank" href="{{ backup_link }}" id="button-backup">{{ button_save }}</a>
						</div>
					</div>
					<div class="row">
						<label class="col-sm-2 control-label text-right">{{ entry_restore_from_file }}</label>
						<div class="col-sm-10">
							<table class="restore-table">
							  <tr>
								<td>
								  <input class="btn btn-default" name="import" type="file" />
								  <input name="restore" type="hidden" value="0" id="restore" />
								</td>
								<td>
								  <a class="btn btn-primary button-restore" disabled="disabled">{{ button_restore }}</a>
								</td>
							  </tr>
							</table>
						</div>
					</div>
				  </div>
				</div>
			</div>

		 </div>
		</div>
	</div>
  </div>
</form>
</section>
<script type="text/javascript"><!--

var has_permission = '{{ has_permission }}';

$('input[name=\'import\']').bind('change', function() {
	if (!has_permission) {
		toastr.warning('{{ error_permission }}', '{{ text_alert_warning }}');
		$('input[name=\'import\']').val('');
		return false;
	}
	var imp = $('input[name=\'import\']').val();
	if (imp) {
		$('.button-restore').attr('disabled', false);
	} else {
		$('.button-restore').attr('disabled', true);
	}
});

$('.button-restore').bind('click', function() {
	if (!has_permission) {
		toastr.warning('{{ error_permission }}', '{{ text_alert_warning }}');
		return false;
	}
	var imp = $('input[name=\'import\']').val();
	if (!imp) { return false; }

	var template_id = '{{ template_id }}';

	if (template_id < 1) {
		toastr.error('{{ error_restore_no_template }}', '{{ text_alert_error }}');
		return false;
	} else {
		$('#restore').val(1);
		var url = '{{ restore_link }}';
		url = url.replace(/&amp;/g, "&");
		$('#form').attr('action', url).submit();
	}
});

$('#button_save').bind('click', function() {
	if (!has_permission) {
		toastr.warning('{{ error_permission }}', '{{ text_alert_warning }}');
		return false;
	} else if (!window.validation.isValid({ container: '#form' })) {
		toastr.error('{{ text_error_form }}', '{{ text_alert_error }}');
		return false;
	} else {
		var url = '{{ action }}';
		url = url.replace(/&amp;/g, "&");
		$('#form').attr('action', url).submit();
	}
});

// preview
$(document).delegate('#export-preview', 'click', function() {
	var order_id = $('#test-order-id').val();
	if (order_id) {
		var url = '{{ preview }}';
		url = url.replace(/&amp;/g, "&");
		url += '&order_id=' + order_id;
		window.open(url, '_blank'); return false;
	}
});

--></script>

<script type="text/javascript"><!--

$(document).delegate('.select-col-format', 'change', function() {
	var format = $(this).val();
	var key = $(this).data("key");
	var i_row = $(this).data("i_row");
	var i_col = $(this).data("i_col");
	var target_id = '#format_add_'+key+'_'+i_row+'_'+i_col;

	if (format == 'image') {
		html = '<div class="input-group valid-block">';
		html += '<span class="input-group-addon" data-toggle="tooltip" title="{{ text_col_img_size }}"><i class="fa fa-image"></i></span>';
		html += '<input type="text" name="template['+key+']['+i_row+'][columns]['+i_col+'][img_width]" value="50" class="field-input numeric form-control" />';
		html += '<span class="input-group-addon">x</span>';
		html += '<input type="text" name="template['+key+']['+i_row+'][columns]['+i_col+'][img_height]" value="50" class="field-input numeric form-control"  />';
		html += '</div>';

		$(target_id).html(html);
	} else if (format == 'link') {
		html = '<div class="input-group">';
		html += '<span class="input-group-addon" data-toggle="tooltip" title="{{ text_col_link_text }}"><i class="fa fa-text-width"></i></span>';
		html += '<textarea name="template['+key+']['+i_row+'][columns]['+i_col+'][text]" rows="1" class="htmlTextArea form-control"  style="min-width: 200px;"></textarea>';

		html += '</div>';

		$(target_id).html(html);
	} else {
		$(target_id).html('');
	}
	tooltipRefresh();
	prepareTextArea($(target_id+' .htmlTextArea'));
});

function toggleStyle(action, type, row, col) {
	var target_id = '#style_'+type+'_'+row+'_'+col;

	if (action == 'remove') {
		html = '<a onclick="toggleStyle(\'add\',\''+type+'\',\''+row+'\',\''+col+'\');" class="btn btn-primary" data-toggle="tooltip" title="{{ btn_add_style }}"><i class="fa fa-plus-circle"></i></a>';

		$(target_id).html(html);
	} else {
		html = '';
		html += '<div class="input-group">';
		html += ' <div class="input-group-btn"><a onclick="toggleStyle(\'remove\',\''+type+'\',\''+row+'\',\''+col+'\');" class="btn btn-default" data-toggle="tooltip" title="{{ btn_remove_style }}"><i class="fa fa-times-circle"></i></a></div>';
		html += ' <span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_font }}"><i class="fa fa-font"></i></span>';
		html += ' <select name="template['+type+']['+row+'][columns]['+col+'][style][font][name]" class="form-control" style="min-width: 160px;">';
	  {% for font in font_list %}
		html += '  <option value="{{ font }}">{{ font }}</option>';
	  {% endfor %}
		html += ' </select>';
		html += ' <span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_font_size }}"><i class="fa fa-text-height"></i></span>';
		html += ' <input type="text" name="template['+type+']['+row+'][columns]['+col+'][style][font][size]" value="10" class="field-input numericmustbe form-control" placeholder="10"  style="min-width: 40px;" />';
		html += ' <span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_font_color }}"><i class="fa fa-adjust"></i></span>';
		html += ' <input type="text" name="template['+type+']['+row+'][columns]['+col+'][style][font][color][rgb]" value="000000" class="form-control jscolor {mode:\'HVS\',position:\'right\'}" style="min-width: 70px;" />';
		html += ' <div class="input-group-btn" data-toggle="buttons">';
		html += '  <label class="btn btn-default" data-toggle="tooltip" title="{{ text_style_title_font_bold }}"><input type="checkbox" value="1" name="template['+type+']['+row+'][columns]['+col+'][style][font][bold]" /><i class="fa fa-bold"></i></label>';
		html += '  <label class="btn btn-default" data-toggle="tooltip" title="{{ text_style_title_font_italic }}"><input type="checkbox" value="1" name="template['+type+']['+row+'][columns]['+col+'][style][font][italic]" /><i class="fa fa-italic"></i></label>';
		html += '  <label class="btn btn-default" data-toggle="tooltip" title="{{ text_style_title_font_underline }}"><input type="checkbox" value="1" name="template['+type+']['+row+'][columns]['+col+'][style][font][underline]" /><i class="fa fa-underline"></i></label>';
		html += '  <label class="btn btn-default" data-toggle="tooltip" title="{{ text_style_title_font_strike }}"><input type="checkbox" value="1" name="template['+type+']['+row+'][columns]['+col+'][style][font][strike]" /><i class="fa fa-strikethrough"></i></label>';
		html += ' </div>';
		html += ' <span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_font_fill }}"><i class="fa fa-circle"></i></span>';
		html += ' <input type="text" name="template['+type+']['+row+'][columns]['+col+'][style][fill][color][rgb]" value="ffffff" class="form-control jscolor {mode:\'HVS\',position:\'right\'}" style="min-width: 70px;" />';
		html += ' <input type="hidden" name="template['+type+']['+row+'][columns]['+col+'][style][fill][type]" value="solid" />';
		html += ' <span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_border_style }}"><i class="fa fa-square-o"></i></span>';
		html += ' <select name="template['+type+']['+row+'][columns]['+col+'][style][borders][allborders][style]" class="form-control" style="min-width: 80px;">';
		{% for style in border_style_list %}
		html += '  <option value="{{ style }}">{{ style }}</option>';
		{% endfor %}
		html += ' </select>';
		html += ' <span class="input-group-addon" data-toggle="tooltip" title="{{ text_style_title_border_color }}"><i class="fa fa-square"></i></span>';
		html += ' <input type="text" name="template['+type+']['+row+'][columns]['+col+'][style][borders][allborders][color][rgb]" value="000000" class="form-control jscolor {mode:\'HVS\',position:\'right\'}" style="min-width: 70px;" />';
		html += ' </div>';
		html += '</div>';

		$(target_id).html(html);

		$('.jscolor').each(function() {
			new jscolor($(this)[0]);
		});
	}
	tooltipRefresh();
}

function addRow(type, row){
	var set_id = type+''+row;

	html = '';
	html += '<div class="panel panel-default '+type+'-row-panel">';
	html += ' <div class="panel-heading">';
	html += '  <div class="valid-block">';
	html += '   <div class="input-group">';
	html += '    <span class="input-group-addon">';
	html += '     <i class="fa fa-arrows handle" data-toggle="tooltip" title="{{ text_moove_to_sort }}"></i>&nbsp;&nbsp; <a data-toggle="collapse" href="#set-'+set_id+'"><i class="fa fa-sort text-blue"></i>&nbsp;&nbsp; {{ text_row }} '+row+'</a>';
	html += '    </span>';
	html += '    <span class="input-group-addon">{{ text_row_type }}</span>';
	html += '    <span class="input-group-addon" data-toggle="tooltip" title="{{ text_row_type_info }}"><i class="fa fa-info text-blue"></i></span>';
	html += '    <select name="template['+type+']['+row+'][type]" class="form-control">';
	html += '     <option value="title">{{ text_row_type_title }}</option>';
	html += '     <option value="data">{{ text_row_type_data }}</option>';
	html += '    </select>';
	html += '    <span class="input-group-addon">{{ text_row_height }}</span>';
	html += '    <span class="input-group-addon" data-toggle="tooltip" title="{{ text_row_height_info }}"><i class="fa fa-info text-blue"></i></span>';
	html += '    <input type="text" name="template['+type+']['+row+'][height]" value="20" class="field-input numeric form-control" placeholder="20" />';
	html += '   <div class="input-group-btn"><a onclick="$(this).closest(\'.'+type+'-row-panel\').remove(); tooltipRefresh();"  class="btn btn-danger" data-toggle="tooltip" title="{{ button_remove_row }}"><i class="fa fa-minus-circle"></i></a></div>';
	html += '   </div>';
	html += '  </div>';
	html += ' </div>';

	html += ' <div id="set-'+set_id+'" class="panel-collapse collapse in">';
	html += ' <div class="panel-body table-responsive">';
	html += '  <table class="table table-bordered table-striped '+type+'-col-table" id="'+type+'-col-table'+row+'">';

	html += '   <thead>';
	html += '    <tr>';
	html += '     <th class="text-center" style="width: 1%;">#</th>';
	html += '     <th style="min-width: 180px;">{{ text_column_format }}</th>';
	html += '     <th style="min-width: 200px;">{{ text_column_format_param }}</th>';
	html += '     <th style="min-width: 60px;"><i class="fa fa-clone"></i>&nbsp;&nbsp;<i class="fa fa-info-circle text-blue" data-toggle="tooltip" title="{{ text_column_merge }}"></i></th>';
	html += '     <th style="min-width: 185px; width: 185px;">{{ text_column_align }}&nbsp;&nbsp;<i class="fa fa-info-circle text-blue" data-toggle="tooltip" title="{{ text_column_align_info }}"></i></th>';
	html += '     <th style="min-width: 400px;">{{ text_column_value }}';
	if (type == 'order' || type == 'product') {
		html += '&nbsp;&nbsp;&nbsp;<a onclick="getTableCodes(\''+type+'\');" style="font-weight: normal; cursor: pointer;">{{ text_table_fields_codes }}</a>';
	}
	html += '     </th>';
	html += '     <th style="width: ">{{ text_column_style }}</th>';
	html += '     <th style="width: 60px;"></th>';
	html += '    </tr>';
	html += '   </thead>';

	html += '   <tbody class="tbody-sortable"></tbody>';
	html += '   <tfoot>';
	html += '    <tr class="active">';
	html += '     <td></td>';
	html += '     <td colspan="7"><a onclick="" class="btn btn-primary add-column-row" data-toggle="tooltip" title="{{ button_add_column }}"><i class="fa fa-plus"></i></a></td>';
	html += '    </tr>';
	html += '   </tfoot>';
	html += '  </table>';
	html += ' </div>';
	html += ' </div>';
	html += '</div>';

	$('#'+type+'-row-group .add-row-panel').before(html);
	addRowColumn(type, row, 1); row++;
	$('#'+type+'-row-group a.add-row').attr('onclick', 'addRow(\''+type+'\',\''+row+'\')');
}

function addRowColumn(type, row, col) {
	html = '';
	html += '<tr id="'+type+'-col-table-row'+row+'_'+col+'" class="col-table-row">';
	html += ' <td class="text-center handle handle-col" data-toggle="tooltip" title="{{ text_moove_to_sort }}"><i class="fa fa-arrows"></i><br/>'+col+'</td>';
	html += ' <td>';
	html += '  <select name="template['+type+']['+row+'][columns]['+col+'][format]" class="select-col-format form-control" data-key="'+type+'" data-i_row="'+row+'" data-i_col="'+col+'">';
	{% for format,format_name in col_format_list %}
	html += '   <option value="{{ format }}">{{ format_name }}</option>';
	{% endfor %}
	html += '  </select>';
	html += ' </td>';
	html += ' <td id="format_add_'+type+'_'+row+'_'+col+'"></td>';
	html += ' <td><input type="text" name="template['+type+']['+row+'][columns]['+col+'][merge]" value="1" class="field-input numeric form-control" placeholder="1"/></td>';

	html += ' <td>';
	html += '  <div class="btn-group btn-group-justified btn-group-xs" data-toggle="buttons">';
	html += '   <label class="btn btn-default" data-toggle="tooltip" title="{{ text_align_hor_left }}"><input type="radio" value="left" name="template['+type+']['+row+'][columns]['+col+'][alignment][horizomtal]" /><i class="fa fa-align-left"></i></label>';
	html += '   <label class="btn btn-default active" data-toggle="tooltip" title="{{ text_align_hor_center }}"><input type="radio" value="center" name="template['+type+']['+row+'][columns]['+col+'][alignment][horizomtal]" checked /><i class="fa fa-align-center"></i></label>';
	html += '   <label class="btn btn-default" data-toggle="tooltip" title="{{ text_align_hor_right }}"><input type="radio" value="right" name="template['+type+']['+row+'][columns]['+col+'][alignment][horizomtal]" /><i class="fa fa-align-right"></i></label>';
	html += '   <label class="btn btn-default" data-toggle="tooltip" title="{{ text_align_hor_justify }}"><input type="radio" value="justify" name="template['+type+']['+row+'][columns]['+col+'][alignment][horizomtal]" /><i class="fa fa-align-right"></i></label>';
	html += '   <label class="btn btn-default" data-toggle="tooltip" title="{{ text_align_hor_distributed }}"><input type="radio" value="distributed" name="template['+type+']['+row+'][columns]['+col+'][alignment][horizomtal]" /><i class="fa fa-align-right"></i></label>';
	html += '  </div>';

	html += '  <div class="btn-group btn-group-justified btn-group-xs" data-toggle="buttons">';
	html += '   <label class="btn btn-default" data-toggle="tooltip" title="{{ text_align_ver_top }}"><input type="radio" value="top" name="template['+type+']['+row+'][columns]['+col+'][alignment][vertical]" /><i class="fa fa-hourglass-start"></i></label>';
	html += '   <label class="btn btn-default active" data-toggle="tooltip" title="{{ text_align_ver_center }}"><input type="radio" value="center" name="template['+type+']['+row+'][columns]['+col+'][alignment][vertical]" checked /><i class="fa fa-hourglass-o"></i></label>';
	html += '   <label class="btn btn-default" data-toggle="tooltip" title="{{ text_align_ver_bottom }}"><input type="radio" value="bottom" name="template['+type+']['+row+'][columns]['+col+'][alignment][vertical]" /><i class="fa fa-hourglass-end"></i></label>';
	html += '   <label class="btn btn-default" data-toggle="tooltip" title="{{ text_align_ver_justify }}"><input type="radio" value="justify" name="template['+type+']['+row+'][columns]['+col+'][alignment][vertical]" /><i class="fa fa-hourglass-end"></i></label>';
	html += '   <label class="btn btn-default" data-toggle="tooltip" title="{{ text_align_ver_distributed }}"><input type="radio" value="distributed" name="template['+type+']['+row+'][columns]['+col+'][alignment][vertical]" /><i class="fa fa-hourglass-end"></i></label>';
	html += '  </div>';
	html += ' </td>';

	html += ' <td><textarea name="template['+type+']['+row+'][columns]['+col+'][value]" rows="1" class="htmlTextArea form-control"></textarea></td>';
	html += ' <td id="style_'+type+'_'+row+'_'+col+'"><a onclick="toggleStyle(\'add\',\''+type+'\',\''+row+'\',\''+col+'\');" class="btn btn-primary" data-toggle="tooltip" title="{{ btn_add_style }}"><i class="fa fa-plus-circle"></i></a></td>';
	html += ' <td><a onclick="$(this).closest(\'.col-table-row\').remove(); tooltipRefresh();"  class="btn btn-danger" data-toggle="tooltip" title="{{ button_remove_row }}"><i class="fa fa-minus-circle"></i></a></td>';
	html += ' </tr>';

	$('#'+type+'-col-table'+row+' .tbody-sortable').append(html);

	var htmlTextArea = $('#'+type+'-col-table-row'+row+'_'+col+' .htmlTextArea');

	col++;

	$('#'+type+'-col-table'+row+' a.add-column-row').attr('onclick', 'addRowColumn(\''+type+'\',\''+row+'\',\''+col+'\')');

	$('#'+type+'-col-table'+row+' .tbody-sortable .btn').each(function() {
		var btn = $(this), input = btn.find('input');
		if (input.length && input.attr('type') && (input.attr('type') == 'checkbox' || input.attr('type') == 'radio')) {
			$(document).delegate(input, 'change', function() {
				if (btn.hasClass('active')) { input.prop('checked', true); }
				setTimeout(function() { btn.removeClass('focus'); }, 100 );
			});
			input.trigger('change');
		}
	});

	prepareTextArea(htmlTextArea);
	$(function () { window.validation.init({ container: '#form' });});
	tooltipRefresh();
	prepareSortable();

}

function setTextArea(elem = false) {
	if (elem) {
		var cm = CodeMirror.fromTextArea(elem[0], { height: "auto", mode: "text/html", theme: 'rubyblue', lineNumbers: true, matchBrackets: true, lineWrapping: true, autoRefresh: true })
		.on('change', editor => {
			elem.html(editor.getValue()).trigger('change');
		});
	}
}

function prepareTextArea(elem = false) {
	if (!elem) {
		$('.htmlTextArea').each(function(){ setTextArea($(this)); });
	} else { setTextArea(elem); }
}

function prepareSortable() {
	row_list = 'header order product footer'.split(/\s+/);
	$.each(row_list, function (i, type) {

		var dropElSelector = '#'+type+'-row-group';
		var param = {}; param['group'] = {};
		param['group']['name'] = ''+type+'-rows';
		param['handle'] = '.handle';
		param['draggable'] = '.'+type+'-row-panel';
		param['ghostClass'] = 'sortable-elem';

		sortableStartGroup(dropElSelector, param);

		var dropElSelector = '.'+type+'-col-table > .tbody-sortable';
		var param = {}; param['group'] = {}; param['group'][type] = {};
		param['group'][type]['name'] = ''+type+'-table-rows';
		param['handle'] = '.handle';
		param['draggable'] = 'tr';
		param['ghostClass'] = 'sortable-elem';

		sortableStartGroup(dropElSelector, param);
	});
}

$(document).ready(function(){
	var error = '{{ error_warning }}';
	var success = '{{ success }}';
	if (error) {
		modalAlert('modal-danger', '{{ text_alert_error }}', '<p>'+error+'</p>', '');
	}
	if (success) {
		toastr.success(success, '{{ text_alert_success }}');
	}

	prepareTextArea();
	prepareSortable();
	controlCheckedInput();
	tooltipRefresh();
	$(function () { window.validation.init({ container: '#form' });});

	$('.nav-tabs').each(function(){
		$(this).find('a:first').tab('show');
	});

	$(document).delegate('#form, #form input, #form sellect, #form textarea', 'change', function() {
		if ($('#button_save').hasClass('btn-primary')) {
			$('#button_save').removeClass('btn-primary').addClass('btn-danger');
		}
	});

});

//--></script>

</div>
{{ footer }}