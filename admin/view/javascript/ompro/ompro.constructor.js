"use strict";var cur_mode,styleList,excludeList,headerClassList,groupClassList,inputClassList,rowClassList,colClassList,boxClassList,fieldClassList,elem,sizesList;function preview(){initEdit(cur_mode='preview');sidebarClose();elementsClose()};function parcing(){var tempDom=$('<div></div>').append($.parseHTML($('#editor').html()));$(document).find('[multiselect]').each(function(){$(this).multiselect('destroy');$(this).unwrap();$(this).attr('multiple',null)});var filterDATA={};var filterOrderDATA={};var filterProductDATA={};tempDom.find('[filterInputGroup]').each(function(){var input_group=$(this);var filter=input_group.find('[filter_Input]');if(!filter.length){var filter=input_group.find('[filter_product_Input]')};if(!filter.length){return false};var filter_type='filter';if(filter.hasAttr('filter_product_Input')){filter_type='filter_product'};var btn_clear_find='clear_'+filter_type+'_this';var btn_clear=input_group.find('[data-btnaction="'+btn_clear_find+'"]');if(btn_clear.length){var btn_clear_status=1;if(filter.hasAttr('multiselect')){var btn_clear_position=filter.parent().prev('[filterBtnClearGroup]').length?'left':filter.parent().next('[filterBtnClearGroup]').length?'right':'left'}else{var btn_clear_position=filter.prev('[filterBtnClearGroup]').length?'left':filter.next('[filterBtnClearGroup]').length?'right':'left'};if(btn_clear.hasAttr('data-original-title')){var btn_clear_title=btn_clear.attr('data-original-title')}else{var btn_clear_title=btn_clear.attr('title')};btn_clear_title=btn_clear_title?btn_clear_title:'';var btn_clear_tooltip=btn_clear.attr('data-toggle')=='tooltip'?'tooltip':'';var btn_clear_class=btn_clear.attr('class');var btn_html=btn_clear.html();var btn_icon_el=btn_clear.find('.fa');var btn_icon_html=btn_icon_el.length?btn_icon_el[0].outerHTML:'';var btn_clear_icon=btn_icon_el.length?btn_icon_el.attr('class'):'fa fa-times-circle';var btn_clear_text=btn_clear.text();var btn_html_tmp=delAllSpaces(btn_html);if(btn_html_tmp===delAllSpaces(btn_icon_html)){btn_clear_type='icon'}else if(btn_html_tmp===delAllSpaces(btn_clear_text)){btn_clear_type='text'}else if(btn_html_tmp===delAllSpaces(btn_icon_html+btn_clear_text)){btn_clear_type='icontext'}else if(btn_html_tmp===delAllSpaces(btn_clear_text+btn_icon_html)){btn_clear_type='texticon'}}else{var btn_clear_status=0;var btn_clear_position='left';var btn_clear_type='icon';var btn_clear_title='';var btn_clear_tooltip='';var btn_clear_class='btn btn-default';var btn_clear_icon='fa fa-times-circle'};if(filter.hasAttr('filter_Input')){var i=input_group.attr('filterID').trim()}else{var i=input_group.attr('filter_productID').trim()};if(filter_type=='filter'){filterOrderDATA[i]={};filterOrderDATA[i]['filter_id']=i;filterOrderDATA[i]['input_group_class']=input_group.attr('class');filterOrderDATA[i]['filter_reload']=filter.attr('filterReload')==1?1:0;filterOrderDATA[i]['btn_clear_status']=btn_clear_status;filterOrderDATA[i]['btn_clear_position']=btn_clear_position;filterOrderDATA[i]['btn_clear_type']=btn_clear_type;filterOrderDATA[i]['btn_clear_title']=btn_clear_title;filterOrderDATA[i]['btn_clear_tooltip']=btn_clear_tooltip;filterOrderDATA[i]['btn_clear_text']=btn_clear_text;filterOrderDATA[i]['btn_clear_class']=btn_clear_class;filterOrderDATA[i]['btn_clear_icon']=btn_clear_icon;input_group.replaceWith('{filterID='+filterOrderDATA[i]['filter_id']+'}')}else{filterProductDATA[i]={};filterProductDATA[i]['filter_id']=i;filterProductDATA[i]['input_group_class']=input_group.attr('class');filterProductDATA[i]['filter_reload']=filter.attr('filterReload')==1?1:0;filterProductDATA[i]['btn_clear_status']=btn_clear_status;filterProductDATA[i]['btn_clear_position']=btn_clear_position;filterProductDATA[i]['btn_clear_type']=btn_clear_type;filterProductDATA[i]['btn_clear_title']=btn_clear_title;filterProductDATA[i]['btn_clear_tooltip']=btn_clear_tooltip;filterProductDATA[i]['btn_clear_text']=btn_clear_text;filterProductDATA[i]['btn_clear_class']=btn_clear_class;filterProductDATA[i]['btn_clear_icon']=btn_clear_icon;input_group.replaceWith('{filterProductID='+filterProductDATA[i]['filter_id']+'}')}});$('#data-filters-top').val(JSON.stringify(filterOrderDATA));$('#data-filters-product').val(JSON.stringify(filterProductDATA));tempDom.find('[data-toggle="tooltip"]').each(function(){var elem=$(this);elem.tooltip('destroy');elem.attr('title',$(this).attr('data-original-title'));elem.removeAttr('data-original-title')});tempDom.find('[data-dropdownmenu]').each(function(){var dropdownmenu=$(this).attr('data-dropdownmenu');$(this).replaceWith('{'+dropdownmenu+'}')});var compatibility_btns='orderpro_edit orderpro_add orderpro_invoice orderpro_merge_orders orderpro_export_orders nova_or_ukrposhta_list'.split(/\s+/);$.each(compatibility_btns,function(i,btn){tempDom.find('[data-btnaction="'+btn+'"]').each(function(){$(this).replaceWith('[['+$(this)[0].outerHTML+'{'+btn+'_btn}]]')})});tempDom.find('[data-orderTPL]').each(function(){var orderTPL=$(this).attr('data-orderTPL');$(this).replaceWith('{orderTPL_'+orderTPL+'}')});tempDom.find('#order-map').each(function(){$(this).html('')});tempDom.find('[ocdashboardwidget]').each(function(){var widget=$(this).attr('ocdashboardwidget');$(this).html('{oc_dashboard_widget_'+widget+'}')});tempDom.find('[omprowidget]').each(function(){var widget=$(this).attr('omprowidget');$(this).replaceWith('{ompro_widget_'+widget+'}')});tempDom.find('[contentvar]').each(function(){var contentvar=$(this).attr('contentvar');$(this).replaceWith('[[{'+contentvar+'}]]')});tempDom.find('[data-elem="pagination"]').each(function(){$(this).html('{pagination}')});tempDom.find('[data-elem="pagination_results"]').each(function(){$(this).html('{pagination_results}')});tempDom.find('[selectOptions]').each(function(){var options=$(this).attr('selectOptions');$(this).html('{'+options+'}')});$('#data-constructor').val(tempDom.html().replace(/[\s]{2,}/g,' '))};function delAllSpaces(str){var str=str.replace(/\s/g,'');return str};function delDoubleSpaces(str){var str=str.replace(/\s{2,}/g,' ').trim();return str};function colSizeList(){var sizes='xs sm md lg';var sizesList=sizes.split(/\s+/);var size_list='';$.each(sizesList,function(index,size){for(var i=1;i<=12;i++){size_list+='col-'+size+'-'+i+' '}});return size_list.trim().split(/\s+/)};function genPass(prefix='',len=8){var pass="";var symbols='abdefhiknrstyzABDEFGHKNQRSTYZ23456789';for(var i=0;i<len;i++){pass+=symbols.charAt(Math.floor(Math.random()*symbols.length))};return prefix+pass};function initControllSidebar(text=''){hideBtnIcons();$('.control-sidebar').html(calloutWarning(text));$('.form-open').removeClass('form-open')};function startValidation(form_id){$(function(){window.validation.init({container:'#'+form_id})})};function startValidationAdd(){startValidation('top_row');startValidation('tab_map');startValidation('tab_orders')};function blockBtnClick(){$('#elements-preview .btn').each(function(){$(this).click(function(e){e.preventDefault();e.stopPropagation();return false})});$('#editor .btn').each(function(){$(this).click(function(e){e.preventDefault();e.stopPropagation();return false})})};function sidebarOpen(){if(!$('.control-sidebar').hasClass('control-sidebar-open')){$('body').addClass('control-sidebar-open');$('.control-sidebar').addClass('control-sidebar-open')}};function sidebarClose(){if($('.control-sidebar').hasClass('control-sidebar-open')){$('body').removeClass('control-sidebar-open');$('.control-sidebar').removeClass('control-sidebar-open')}};function elementsOpen(){$('#box-elements').slideDown()};function elementsClose(){$('#box-elements').slideUp()};function tooltipDestroy(elem){var tooltip=elem.attr('data-toggle');if(tooltip&&tooltip=='tooltip'){elem.tooltip('destroy');elem.attr('title',$(this).attr('data-original-title'));elem.removeAttr('data-original-title')}};function initEdit(cur_mode){$('.form-open').removeClass('form-open');var classList='preview row col box blocks btn btngroup inputgroup sortTools sortColElem'.split(/\s+/);$.each(classList,function(i,cl){if(cl==cur_mode){$('#editor').addClass(cur_mode+'-mode');$('#box-elements').addClass(cur_mode+'-mode')}else{$('#editor').removeClass(cl+'-mode');$('#box-elements').removeClass(cl+'-mode')}});$(document).undelegate('.btn-edit-form','change');$(document).undelegate('.row-edit-form','change');$(document).undelegate('.col-edit-form','change');$(document).undelegate('.box-edit-form','change');$(document).undelegate('.ordertable-edit-form','change');$(document).undelegate('.edit-form-open','click');$('.edit-tools').remove();var attrList='data-drop dropColElem sortableElem editedElem dropToolsElem dropBtnGroupElem dropInputGroupElem editArea'.split(/\s+/);$.each(attrList,function(i,attr){sortableDestroy('['+attr+']');if(attr=='sortableElem'&&$('['+attr+']').find('select').length){$('['+attr+']').find('select').prop('disabled',false)};$('['+attr+']').unbind('click mousedown').off('click mousedown').removeAttr(attr)});$('#elements-preview .btn:not(.ms-reset-btn)').each(function(){$(this).unbind('click')});$('#editor .btn:not(.ms-reset-btn)').each(function(){$(this).unbind('click')});$('.input-group').each(function(){$(this).unbind('click')})}function prepareSortRow(){$('#elements-preview, #elements-preview .box-body, #elements-preview .col, #elements-preview .box-footer, #editor, #editor .col, #editor .box-body, #editor .box-footer').attr('data-drop','row');$('[data-drop="row"]').each(function(){if($(this).closest('[data-orderTPL]').length){$(this).removeAttr('data-drop')}});$('[data-drop="row"] > .row').each(function(){var elem=$(this);var id=elem.attr('id');if(!id){id=genPass('row_',4);elem.attr('id',id)}$(this).prepend('<span class="edit-tools btn-group btn-group-xs"><a class="handle-row btn btn-danger" data-toggle="tooltip"  title="Сортировать"><i class="fa fa-arrows"></i></a><a class="edit-form-open btn btn-danger" data-edit-type="row" data-edit-targetid="'+id+'" data-toggle="tooltip" title="Редактировать"><i class="fa fa-edit"></i></a><a class="btn btn-danger remove-row" data-toggle="tooltip" title="Удалить"><i class="fa fa-times"></i></a></span>')});var dropElSelector='[data-drop="row"]';var param={};param['group']={};param['group']['name']='rows';param['handle']='.handle-row';param['filter']='';param['draggable']='.row';param['ghostClass']='sortable-elem';sortableStartGroup(dropElSelector,param)}function prepareSortCol(){$('#elements-preview .row, #editor .row').attr('data-drop','col');$('[data-drop="col"]').each(function(){if($(this).closest('[data-orderTPL]').length){$(this).removeAttr('data-drop')}});$('[data-drop="col"] > .col').each(function(){var elem=$(this);var id=elem.attr('id');if(!id){id=genPass('col_',4);elem.attr('id',id)};$(this).prepend('<span class="edit-tools btn-group btn-group-xs"><a class="handle-col btn btn-info" data-toggle="tooltip"  title="Сортировать"><i class="fa fa-arrows"></i></a><a class="edit-form-open btn btn-info" data-edit-type="col" data-edit-targetid="'+id+'" data-toggle="tooltip" title="Редактировать"><i class="fa fa-edit"></i></a><a class="btn btn-info" data-toggle="tooltip" title="Удалить" onclick="$(this).parent().parent().remove(); tooltipRefresh();"><i class="fa fa-times"></i></a></span>')});var dropElSelector='[data-drop="col"]';var param={};param['group']={};param['group']['name']='cols';param['handle']='.handle-col';param['filter']='';param['draggable']='.col';param['ghostClass']='sortable-elem';sortableStartGroup(dropElSelector,param)}function prepareSortBox(){$('#elements-preview .col, #editor .col').attr('data-drop','box');$('[data-drop="box"]').each(function(){if($(this).closest('[data-orderTPL]').length){$(this).removeAttr('data-drop')}});$('[data-drop="box"] > .box').each(function(){var elem=$(this);var id=elem.attr('id');if(!id){id=genPass('box_',4);elem.attr('id',id)};$(this).prepend('<span class="edit-tools btn-group btn-group-xs"><a class="handle-box btn btn-warning" data-toggle="tooltip"  title="Сортировать"><i class="fa fa-arrows"></i></a><a class="edit-form-open btn btn-warning" data-edit-type="box" data-edit-targetid="'+id+'" data-toggle="tooltip" title="Редактировать"><i class="fa fa-edit"></i></a><a class="btn btn-warning" data-toggle="tooltip" title="Удалить" onclick="$(this).parent().parent().remove(); tooltipRefresh();"><i class="fa fa-times"></i></a></span>')});var dropElSelector='[data-drop="box"]';var param={};param['group']={};param['group']['name']='boxs';param['handle']='.handle-box';param['filter']='';param['draggable']='.box';param['ghostClass']='sortable-elem';sortableStartGroup(dropElSelector,param)}function prepareEditOrderTable(){$('#elements-preview [data-orderTPL], #editor [data-orderTPL]').attr('data-drop','ordertpl');$('[data-drop="ordertpl"]').each(function(){var elem=$(this);var id=elem.attr('id');if(!id){id=genPass('ordertable_',5);elem.attr('id',id)};$(this).prepend('<span class="edit-tools btn-group btn-group-xs"><a class="edit-form-open btn btn-success" data-edit-type="ordertable" data-edit-targetid="'+id+'" data-toggle="tooltip" title="Изменить шаблон таблицы заказов"><i class="fa fa-edit"></i></a><a class="btn btn-success" data-toggle="tooltip" title="Удалить" onclick="$(this).parent().parent().remove(); tooltipRefresh();"><i class="fa fa-times"></i></a></span>')})}function formRow(target_id,form_id){var row=$('#'+target_id);if($('.control-sidebar #'+form_id).length){$('.form-open').removeClass('form-open');initControllSidebar();return false};$('.form-open').removeClass('form-open');var html='';if(row.length){var rowClassList=row.attr('class')?row.attr('class').split(/\s+/):'';html+='<form class="form row-edit-form" target-id="'+target_id+'" id="'+form_id+'">';html+='<div class="box box-danger box-solid">';html+='<div class="box-header with-border">';html+=' <h3 class="box-title">РЕДАКТИРОВАНИЕ РЯДА</h3>';html+=' <div class="box-tools pull-right">';html+='	 <button type="button" class="btn btn-box-tool pull-right" data-toggle="tooltip" title="Закрыть форму" onclick="$(this).closest(\'.form\').remove(); initControllSidebar(); tooltipRefresh();"><i class="fa fa-times"></i></button>';html+=' </div>';html+='</div>';html+='<div class="box-body bg-danger">';var hideList='row'.split(/\s+/);var hide_class='';var row_class='';$.each(rowClassList,function(i,cl){var clas=cl.trim();if(hideList.in_array(clas)){hide_class+=clas+' '}else{row_class+=clas+' '}});html+='<div class="form-group valid-block">';html+='<div class="input-group input-group-sm"><div class="input-group-addon" data-toggle="tooltip" title="ID ряда" >ID:</div><input type="text" value="'+target_id+'" class="row-id form-control field-input validid"/><div class="input-group-btn"><label class="btn btn-default" data-toggle="tooltip" title="Очистить" onclick="$(this).closest(\'.input-group\').find(\'.row-id\').val(\'\').trigger(\'change\');"><i class="fa fa-times-circle"></i></label></div></div>';html+='</div>';html+=' <p></p>';html+=' <p>Класс(ы)</p>';html+='<div class="form-group valid-block">';html+='<div class="input-group input-group-sm"><input type="text" value="'+delDoubleSpaces(row_class)+'" class="row-class form-control field-input validclass" placeholder="class..." /><div class="input-group-btn"><label class="btn btn-default" data-toggle="tooltip" title="Очистить" onclick="$(this).closest(\'.input-group\').find(\'.row-class\').val(\'\').trigger(\'change\');"><i class="fa fa-times-circle"></i></label></div></div>';html+='</div>';html+='<input type="hidden" value="'+delDoubleSpaces(hide_class)+'" class="row-hide-class" />';html+='</div>';html+='</div>';html+='</form>';row.addClass('form-open')};return html};function formRowChange(){$(document).delegate('.row-edit-form','change',function(e){var form=$(this);var target_id=$(this).attr('target-id');var row=$('#'+target_id);if(row.length){var form_id='form_'+target_id;var row_id=form.find('.row-id')?form.find('.row-id').val().trim():'';if(!window.validation.isValid({container:'#'+form_id})){return false};if(row_id&&row_id!==target_id){row.attr('id',row_id);row.find('.edit-form-open').attr('data-edit-targetid',row_id);form.attr('target-id',row_id);row=$('#'+row_id)};var row_class=form.find('.row-class').val();row_class=row_class?row_class:'';var hide_class=form.find('.row-hide-class').val();hide_class=hide_class?hide_class:'';var all_class=hide_class+' '+row_class+' form-open';row.attr('class',delDoubleSpaces(all_class));tooltipRefresh()}})};function formCol(target_id,form_id){var col=$('#'+target_id);if($('.control-sidebar #'+form_id).length){$('.form-open').removeClass('form-open');initControllSidebar();return false};$('.form-open').removeClass('form-open');var html='';if(col.length){var colClassList=col.attr('class')?col.attr('class').split(/\s+/):'';html+='<form class="form col-edit-form" target-id="'+target_id+'" id="'+form_id+'">';html+='<div class="box box-info box-solid">';html+='<div class="box-header with-border">';html+=' <h3 class="box-title">РЕДАКТИРОВАНИЕ КОЛОНКИ</h3>';html+=' <div class="box-tools pull-right">';html+='	 <button type="button" class="btn btn-box-tool pull-right" data-toggle="tooltip" title="Закрыть форму" onclick="$(this).closest(\'.form\').remove(); initControllSidebar(); tooltipRefresh();"><i class="fa fa-times"></i></button>';html+=' </div>';html+='</div>';html+='<div class="box-body bg-info">';html+='<div class="form-group valid-block">';html+='<div class="input-group input-group-sm"><div class="input-group-addon" data-toggle="tooltip" title="ID колонки" >ID:</div><input type="text" value="'+target_id+'" class="col-id form-control field-input validid"/><div class="input-group-btn"><label class="btn btn-default" data-toggle="tooltip" title="Очистить" onclick="$(this).closest(\'.input-group\').find(\'.col-id\').val(\'\').trigger(\'change\');"><i class="fa fa-times-circle"></i></label></div></div>';html+='</div>';var hideList='col'.split(/\s+/);var hide_class='';var col_class='';$.each(colClassList,function(i,cl){var clas=cl.trim();if(hideList.in_array(clas)){hide_class+=clas+' '}else{col_class+=clas+' '}});html+=' <p></p>';html+=' <p>Класс(ы)</p>';html+='<div class="form-group valid-block">';html+='<div class="input-group input-group-sm"><input type="text" value="'+delDoubleSpaces(col_class)+'" class="col-class form-control field-input validclass" placeholder="col-sm-12" /><div class="input-group-btn"><label class="btn btn-default" data-toggle="tooltip" title="Очистить" onclick="$(this).closest(\'.input-group\').find(\'.col-class\').val(\'\').trigger(\'change\');"><i class="fa fa-times-circle"></i></label></div></div>';html+='</div>';html+='<input type="hidden" value="'+delDoubleSpaces(hide_class)+'" class="col-hide-class" />';html+='</div>';html+='</div>';html+='</form>';col.addClass('form-open')};return html};function formColChange(){$(document).delegate('.col-edit-form','change',function(e){var form=$(this);var target_id=$(this).attr('target-id');var col=$('#'+target_id);if(col.length){var form_id='form_'+target_id;var col_id=form.find('.col-id')?form.find('.col-id').val().trim():'';if(!window.validation.isValid({container:'#'+form_id})){return false};if(col_id&&col_id!==target_id){col.attr('id',col_id);col.find('.edit-form-open').attr('data-edit-targetid',col_id);form.attr('target-id',col_id);col=$('#'+col_id)};var col_class=form.find('.col-class').val();col_class=col_class?col_class:'col-sm-12';var hide_class=form.find('.col-hide-class').val();hide_class=hide_class?hide_class:'';var all_class=col_class+' '+hide_class+' form-open';col.attr('class',delDoubleSpaces(all_class));tooltipRefresh()}})};function formBox(target_id,form_id){var box=$('#'+target_id);if($('.control-sidebar #'+form_id).length){$('.form-open').removeClass('form-open');initControllSidebar();return false};$('.form-open').removeClass('form-open');var html='';if(box.length){var boxClassList=box.attr('class')?box.attr('class').split(/\s+/):'';html+='<form class="form box-edit-form" target-id="'+target_id+'" id="'+form_id+'">';var input_style_name=genPass('n_',6);html+='<div class="box box-warning box-solid">';html+='<div class="box-header with-border">';html+=' <h3 class="box-title">РЕДАКТИРОВАНИЕ БОКСА</h3>';html+=' <div class="box-tools pull-right">';html+='	 <button type="button" class="btn btn-box-tool pull-right" data-toggle="tooltip" title="Закрыть форму" onclick="$(this).closest(\'.form\').remove(); initControllSidebar(); tooltipRefresh();"><i class="fa fa-times"></i></button>';html+=' </div>';html+='</div>';html+='<div class="box-body bg-warning">';html+='<div class="form-group valid-block">';html+='<div class="input-group input-group-sm"><div class="input-group-addon" data-toggle="tooltip" title="ID бокса" >ID:</div><input type="text" value="'+target_id+'" class="box-id form-control field-input validid"/><div class="input-group-btn"><label class="btn btn-default" data-toggle="tooltip" title="Очистить" onclick="$(this).closest(\'.input-group\').find(\'.box-id\').val(\'\').trigger(\'change\');"><i class="fa fa-times-circle"></i></label></div></div>';html+='</div>';html+='<div class="box box-default">';html+=' <div class="box-header with-border">';html+=' <h3 class="box-title">Стиль</h3>';html+=' <div class="box-tools pull-right">';var boxClass='box';var active_solid='text-red';var check_solid='';if(boxClassList.in_array('box-solid')){boxClass+=' box-solid';active_solid='active text-green';check_solid='checked="checked"'};var active_withborder='active text-green';var check_withborder='checked="checked"';if(boxClassList.in_array('no-border')){boxClass+=' no-border';active_withborder='text-red';check_withborder=''};html+='  <div class="btn-group btn-group-xs" data-toggle="buttons">';html+='   <label class="btn btn-box-tool check-control '+active_withborder+'" data-toggle="tooltip" title="Граница (border)"><input type="checkbox" class="box-withborder" value="1" '+check_withborder+'/><i class="fa fa-square-o"></i></label>';html+='   <label class="btn btn-box-tool check-control '+active_solid+'" data-toggle="tooltip" title="Заливка"><input type="checkbox" class="box-solid" value="box-solid" '+check_solid+'/><i class="fa fa-square"></i></label>';html+=' </div>';html+=' </div>';html+='</div>';html+=' <div class="box-body">';var box_styles='default initial primary info success warning danger';var styleList=box_styles.split(/\s+/);var btngrouppos=styleList.length>8?'btn-group-vertical btn-block':'btn-group-justified';html+=' <div class="btn-group btn-group-xs '+btngrouppos+'" data-toggle="buttons">';$.each(styleList,function(index,style){if(boxClassList.in_array('box-'+style)){boxClass+=' box-'+style;html+=' <label class="btn btn-'+style+' active"><input type="radio" class="box-style" name="'+input_style_name+'" value="box box-'+style+'" checked="checked"/>'+style+'</label>'}else{html+=' <label class="btn btn-'+style+'"><input type="radio" class="box-style" name="'+input_style_name+'" value="box box-'+style+'"/>'+style+'</label>'}});html+=' </div>';html+=' <p></p>';html+=' <p>Класс(ы)</p>';var exclude_classes='box box-default box-initial box-primary box-info box-success box-warning box-danger box-solid no-border';var excludeList=exclude_classes.split(/\s+/);var add_class='';$.each(boxClassList,function(ii,cl){if(!excludeList.in_array(cl.trim())){add_class+=cl.trim()+' ';boxClass+=' '+cl.trim()}});html+='<div class="form-group valid-block">';html+='<div class="input-group input-group-sm"><input type="text" value="'+delDoubleSpaces(add_class)+'" class="box-add-class form-control field-input validclass" placeholder="class..." /><div class="input-group-btn"><label class="btn btn-default" data-toggle="tooltip" title="Очистить" onclick="$(this).closest(\'.input-group\').find(\'.box-add-class\').val(\'\').trigger(\'change\');"><i class="fa fa-times-circle"></i></label></div></div>';html+='</div>';html+=' </div>';html+='</div>';var header=box.find('> .box-header');var headerClass='box-header';var active_header='text-red';var check_header='';var active_border='text-red';var check_border='';var active_title_status='text-red';var check_title_status='';var titleClass='box-title';var icon='';var title='Title';var subtitle='subtitle';if(header.length){active_header='active text-green';check_header='checked="checked"';var headerClassList=header.attr('class')?header.attr('class').split(/\s+/):'';if(headerClassList&&headerClassList.in_array('with-border')){headerClass+=' with-border';active_border='active text-green';check_border='checked="checked"'};header.find('>*:not(.edit-tools)').each(function(){var classList=$(this).attr('class')?$(this).attr('class').split(/\s+/):'';if(classList){if(classList.in_array('box-title')){active_title_status='active text-green';check_title_status='checked="checked"';icon=$(this).find('> .box-title-icon').length?$(this).find('> .box-title-icon').html():'';title=$(this).find('> .box-title-title').length?$(this).find('> .box-title-title').text():'';subtitle=$(this).find('> .box-title-subtitle').length?$(this).find('> .box-title-subtitle').text():''}}})};html+='<div class="box box-default">';html+='<div class="box-header with-border">';html+=' <h3 class="box-title">Панель заголовка (header)</h3>';html+=' <div class="box-tools pull-right">';html+='  <div class="btn-group btn-group-xs" data-toggle="buttons">';html+='   <label class="btn btn-box-tool check-control '+active_border+'" data-toggle="tooltip" title="Нижняя граница"><input type="checkbox" class="header-border" '+check_border+'/><i class="fa fa-tablet"></i></label>';html+='   <label class="btn btn-box-tool check-control '+active_header+'" data-toggle="tooltip" title="Показать/Скрыть"><input type="checkbox" id="header-toggle"  class="box-view" '+check_header+'/><i class="fa fa-eye"></i></label>';html+=' </div>';html+=' </div>';html+='</div>';html+='<div class="box-body">';html+='<div class="header-form">';var exclude_classes='box-header with-border';var excludeList=exclude_classes.split(/\s+/);var add_class='';if(header.length){$.each(headerClassList,function(ii,cl){if(!excludeList.in_array(cl.trim())){add_class+=cl.trim()+' ';headerClass+=' '+cl.trim()}})};html+='<div class="form-group valid-block">';html+='<div class="input-group input-group-sm"><div class="input-group-addon" data-toggle="tooltip" title="Класс(ы)"><i class="fa fa-info"></i></div><input type="text" value="'+delDoubleSpaces(add_class)+'" class="header-add-class form-control field-input validclass" placeholder="class..." /><div class="input-group-btn"><label class="btn btn-default" data-toggle="tooltip" title="Очистить" onclick="$(this).closest(\'.input-group\').find(\'.header-add-class\').val(\'\').trigger(\'change\');"><i class="fa fa-times-circle"></i></label></div></div>';html+='</div>';html+='</div>';html+='</div>';html+='</div>';html+='<div class="box box-default">';html+='<div class="box-header with-border">';html+=' <h3 class="box-title">Заголовок</h3>';html+=' <div class="box-tools pull-right">';html+='  <div class="btn-group btn-group-xs" data-toggle="buttons">';html+='   <label class="btn btn-box-tool check-control '+active_title_status+'" data-toggle="tooltip" title="Показать/Скрыть"><input type="checkbox" class="header-title-status" '+check_title_status+'/><i class="fa fa-eye"></i></label>';html+='  </div>';html+=' </div>';html+='</div>';html+='<div class="box-body">';html+='<div class="input-group input-group-sm">';html+='<div class="input-group-btn"><button type="button" class="btn btn-default load-icon" data-target-id="icons-'+target_id+'" data-toggle="tooltip" title="Выбрать иконку">'+icon+'</button></div>';html+=' <input type="text" value="'+title+'" class="header-title form-control" placeholder="название заголовка" data-toggle="tooltip" title="Название заголовка" />';html+=' <div class="input-group-btn"><label class="btn btn-default" data-toggle="tooltip" title="Очистить" onclick="$(this).closest(\'.input-group\').find(\'.header-title\').val(\'\').trigger(\'change\');"><i class="fa fa-times-circle"></i></label></div>';html+=' <input type="text" value="'+subtitle+'" class="header-subtitle form-control" placeholder="подзаголовок" data-toggle="tooltip" title="Подзаголовок" />';html+=' <div class="input-group-btn"><label class="btn btn-default" data-toggle="tooltip" title="Очистить" onclick="$(this).closest(\'.input-group\').find(\'.header-subtitle\').val(\'\').trigger(\'change\');"><i class="fa fa-times-circle"></i></label></div>';html+='</div>';html+='<div id="icons-'+target_id+'" class="icons-block" style="display: none;"></div>';html+='</div>';html+='</div>';var hideList='box-body'.split(/\s+/);var active_body='text-red';var check_body='';var body_class='';var body_hide_class='';var body=box.find('> .box-body');if(body.length){active_body='active text-green';check_body='checked="checked"';var bodyClassList=body.attr('class')?body.attr('class').split(/\s+/):'';$.each(bodyClassList,function(i,cl){var clas=cl.trim();if(hideList.in_array(clas)){body_hide_class+=clas+' '}else{body_class+=clas+' '}})}else{body_hide_class='box-body'};html+='<div class="box box-default">';html+='<div class="box-header with-border">';html+=' <h3 class="box-title">ТЕЛО (body)</h3>';html+=' <div class="box-tools pull-right">';html+='  <div class="btn-group btn-group-xs" data-toggle="buttons">';html+='   <label class="btn btn-box-tool check-control '+active_body+'" data-toggle="tooltip" title="Показать/Скрыть"><input type="checkbox" id="body-toggle"  class="body-view" '+check_body+'/><i class="fa fa-eye"></i></label>';html+=' </div>';html+=' </div>';html+='</div>';html+='<div class="box-body">';html+='<div class="body-form">';html+='<p>Body Class(es)</p>';html+='<div class="form-group valid-block">';html+='<div class="input-group input-group-sm"><div class="input-group-addon" data-toggle="tooltip" title="Класс(ы)"><i class="fa fa-info"></i></div><input type="text" value="'+delDoubleSpaces(body_class)+'" class="body-class form-control field-input validclass" placeholder="class..." /><div class="input-group-btn"><label class="btn btn-default" data-toggle="tooltip" title="Очистить" onclick="$(this).closest(\'.input-group\').find(\'.body-class\').val(\'\').trigger(\'change\');"><i class="fa fa-times-circle"></i></label></div></div>';html+='</div>';html+='<input type="hidden" value="'+delDoubleSpaces(body_hide_class)+'" class="body-hide-class" />';html+='</div>';html+='</div>';html+='</div>';var hideList='box-footer'.split(/\s+/);var active_footer='text-red';var check_footer='';var footer_class='';var footer_hide_class='';var footer=box.find('> .box-footer');if(footer.length){active_footer='active text-green';check_footer='checked="checked"';var footerClassList=footer.attr('class')?footer.attr('class').split(/\s+/):'';$.each(footerClassList,function(i,cl){var clas=cl.trim();if(hideList.in_array(clas)){footer_hide_class+=clas+' '}else{footer_class+=clas+' '}})}else{footer_hide_class='box-footer'};html+='<div class="box box-default">';html+='<div class="box-header with-border">';html+=' <h3 class="box-title">ПОДВАЛ (footer)</h3>';html+=' <div class="box-tools pull-right">';html+='  <div class="btn-group btn-group-xs" data-toggle="buttons">';html+='   <label class="btn btn-box-tool check-control '+active_footer+'" data-toggle="tooltip" title="Показать/Скрыть"><input type="checkbox" id="footer-toggle" class="footer-view" '+check_footer+'/><i class="fa fa-eye"></i></label>';html+=' </div>';html+=' </div>';html+='</div>';html+='<div class="box-body">';html+='<div class="body-form">';html+='<p>Footer Class(es)</p>';html+='<div class="form-group valid-block">';html+='<div class="input-group input-group-sm"><div class="input-group-addon" data-toggle="tooltip" title="Класс(ы)"><i class="fa fa-info"></i></div><input type="text" value="'+delDoubleSpaces(footer_class)+'" class="footer-class form-control field-input validclass" placeholder="class..." /><div class="input-group-btn"><label class="btn btn-default" data-toggle="tooltip" title="Очистить" onclick="$(this).closest(\'.input-group\').find(\'.footer-class\').val(\'\').trigger(\'change\');"><i class="fa fa-times-circle"></i></label></div></div>';html+='</div>';html+='<input type="hidden" value="'+delDoubleSpaces(footer_hide_class)+'" class="footer-hide-class" />';html+='</div>';html+='</div>';html+='</div>';html+='</div>';html+='</div>';html+='</form>';box.addClass('form-open')};return html};function formBoxChange(){$(document).delegate('.box-edit-form','change',function(e){var form=$(this);var target_id=$(this).attr('target-id');var box=$('#'+target_id);if(box.length){var form_id='form_'+target_id;var form_id='form_'+target_id;var box_id=form.find('.box-id')?form.find('.box-id').val().trim():'';if(!window.validation.isValid({container:'#'+form_id})){return false};if(box_id&&box_id!==target_id){box.attr('id',box_id);box.find('.edit-form-open').attr('data-edit-targetid',box_id);form.attr('target-id',box_id);box=$('#'+box_id)};var box_style=form.find('.box-style:checked').val();box_style=box_style?box_style:'box box-default';var box_solid=form.find('.box-solid:checked').val();box_solid=box_solid?box_solid:'';var box_withborder=form.find('.box-withborder:checked').val();box_withborder=box_withborder?'':'no-border';var add_class=form.find('.box-add-class').val();add_class=add_class?add_class:'';var all_class=box_style+' '+box_solid+' '+box_withborder+' '+add_class+' form-open';var all_class=all_class.replace(/\s{2,}/g,' ').trim();var header=box.find('> .box-header');var header_status=form.find('#header-toggle').prop('checked')?1:0;var h3_status=form.find('.header-title-status').prop('checked')?1:0;var box_title=box.find('> .box-header > .box-title');if(header_status){var headerClass='box-header';var border=form.find('.header-border').prop('checked')?' with-border':'';var header_add_class=form.find('.header-add-class')?form.find('.header-add-class').val():'';headerClass+=border+' '+header_add_class;var title=form.find('.header-title')?form.find('.header-title').val():'';var subtitle=form.find('.header-subtitle')?form.find('.header-subtitle').val():'';var titleClass='box-title pull-left';var h3='';if(h3_status){h3+='<h3 class="'+titleClass+'">';var icon=form.find('.load-icon')?form.find('.load-icon').html():'';if(icon){h3+=' <span class="box-title-icon">'+icon+' </span>'};if(title){h3+=' <span class="box-title-title">'+title+'</span>'};if(subtitle){h3+=' <small class="box-title-subtitle">'+subtitle+'</small>'};h3+='</h3>';if(box_title.length){box_title.remove();header.prepend(h3)}else{header.prepend(h3)}}else{box_title.remove()};if(header.length){header.attr('class',headerClass)}else{box.prepend('<div class="'+headerClass+'">'+h3+'<div class="box-tools pull-left"></div><div class="box-tools pull-right"><button type="button" class="btn btn-box-tool" data-widget="collapse" data-btnaction="widget_collapse" data-toggle="tooltip" title=""><i class="fa fa-minus"></i></button></div></div>')}}else{header.remove()};var body=box.find('> .box-body');var body_status=form.find('#body-toggle').prop('checked')?1:0;if(body_status){var body_hide_class=form.find('.body-hide-class')?form.find('.body-hide-class').val():'';var body_class=form.find('.body-class')?form.find('.body-class').val():'';var bodyClass=delDoubleSpaces(body_hide_class+' '+body_class);if(body.length){body.attr('class',bodyClass)}else{bodyClass=bodyClass?bodyClass:'box-body';var body_default='<div class="'+bodyClass+'"><div class="row"><div class="col col-sm-12"></div></div></div>';if(box.find('> .box-header').length){box.find('> .box-header').after(body_default)}else if(box.find('> .box-footer').length){box.find('> .box-footer').before(body_default)}else{box.prepend(body_default)};prepareSortRow();prepareSortCol()}}else{body.remove()};var footer=box.find('> .box-footer');var footer_status=form.find('#footer-toggle').prop('checked')?1:0;if(footer_status){var footer_hide_class=form.find('.footer-hide-class')?form.find('.footer-hide-class').val():'';var footer_class=form.find('.footer-class')?form.find('.footer-class').val():'';var footerClass=delDoubleSpaces(footer_hide_class+' '+footer_class);if(footer.length){footer.attr('class',footerClass)}else{footerClass=footerClass?footerClass:'box-footer';var footer_default='<div class="'+footerClass+'"><div class="row"><div class="col col-sm-12"></div></div></div>';if(box.find('> .box-body').length){box.find('> .box-body').after(footer_default)}else if(box.find('> .box-header').length){box.find('> .box-header').after(footer_default)}else{box.prepend(footer_default)};prepareSortRow();prepareSortCol()}}else{footer.remove()};box.attr('class',all_class);tooltipRefresh();$(window).trigger('load');box.addClass('form-open')}})};function editBlocks(){var calloutText='РЕДАКТИРОВАНИЕ БЛОКОВ:';calloutText+='<ol>';calloutText+='<li>Наведите курсор на редактируемый элемент. В появившейся панели инструментов используйте кнопку <i class="fa fa-arrows"></i> для перемещения блока с помощью мыши. Элементы можно перемещать (сортировать) между собой в любом направлении.';calloutText+='<ul>';calloutText+=' <li>Ряды перемещаются в основной панели редактора, внутри колонок и боксов</li>';calloutText+=' <li>Колонки перемещаются внутри рядов</li>';calloutText+=' <li>Боксы перемещаются внутри колонок</li>';calloutText+='</ul></li>';calloutText+='<li><i class="fa fa-edit"></i> - кнопка открытия формы редактирования</li>';calloutText+='<li><i class="fa fa-times"></i> - кнопка удаления элемента</li>';calloutText+='</ol>';if(!$('#editor').hasClass('blocks-mode')){initControllSidebar(calloutText)};initEdit(cur_mode='blocks');blockBtnClick();prepareSortRow();prepareSortCol();prepareSortBox();prepareEditOrderTable();$(document).delegate('.edit-form-open','click',function(e){hideBtnIcons();var target_id=$(this).attr('data-edit-targetid');var form_id='form'+target_id;var type=$(this).attr('data-edit-type');var html='';if(type=='row'){html=formRow(target_id,form_id)}else if(type=='col'){html=formCol(target_id,form_id)}else if(type=='box'){html=formBox(target_id,form_id)}else if(type=='ordertable'){html=formOrderTable(target_id,form_id)};if(html){$('.control-sidebar').html(html);startValidation(form_id)};tooltipRefresh()});formRowChange();formColChange();formBoxChange();formOrderTableChange();tooltipRefresh();sidebarOpen();elementsOpen()};function formBtnChange(){$(document).delegate('.btn-edit-form','change',function(e){var form=$(this);var target_id=$(this).attr('target-id');var btn=$('#'+target_id);if(btn.length){var form_id='form_'+target_id;var btn_id=form.find('.btn-id')?form.find('.btn-id').val().trim():'';if(!window.validation.isValid({container:'#'+form_id})){return false};if(btn_id&&btn_id!==target_id){btn.attr('id',btn_id);form.attr('target-id',btn_id);form.find('.remove-btn').attr('target-id',btn_id);btn=$('#'+btn_id)};var btn_action=form.find('.btn-target-action').val();btn_action=btn_action?btn_action:'';if(btn_action){if(btn_action=='widget_collapse'){btn.attr('data-widget','collapse')};if(btn_action=='widget_remove'){btn.attr('data-widget','remove')};if(btn_action!='widget_collapse'||btn_action=='widget_remove'){btn.removeAttr('data-widget')};btn.attr('data-btnaction',btn_action);var target_action='';if(btn_action=='slide_on_id'||btn_action=='slide_on_class'){form.find('.target-addon').show();if(btn_action=='slide_on_id'){target_action=form.find('.target-action-id').val();form.find('.target-action-id').show()}else{form.find('.target-action-id').val('').hide()};if(btn_action=='slide_on_class'){target_action=form.find('.target-action-class').val();form.find('.target-action-class').show()}else{form.find('.target-action-class').val('').hide()};btn.attr('data-target',target_action)}else{form.find('.target-addon').hide();form.find('.target-action-id').val('').hide();form.find('.target-action-class').val('').hide()}}else{btn.removeAttr('data-widget');btn.removeAttr('data-btnaction');btn.removeAttr('data-target');form.find('.target-addon').hide();form.find('.target-action-id').val('').hide();form.find('.target-action-class').val('').hide()};var size_disabled=false;if(btn.parent().hasClass('btn-group')||btn.parent().hasClass('btn-group-vertical')){var btn_group=btn.parent();if(btn_group.length){size_disabled=true;var btn_group_size=form.find('.btn-group-size:checked').val();btn_group_size=btn_group_size?btn_group_size:'btn-group-md';var btn_group_pos=form.find('.btn-group-pos:checked').val();btn_group_pos=btn_group_pos?btn_group_pos:'btn-group';var btn_group_block=form.find('.btn-group-block:checked').val();btn_group_block=btn_group_block?btn_group_block:'';var group_all_class=btn_group_pos+' '+btn_group_size+' '+btn_group_block;var group_all_class=group_all_class.replace(/\s{2,}/g,' ').trim();btn_group.attr('class',group_all_class)}};var btn_style=form.find('.btn-style:checked').val();btn_style=btn_style?btn_style:'btn btn-default';var btn_add_style='';form.find('.btn-add-style:checked').each(function(){btn_add_style+=$(this).val()+' '});if($('input[type=\'hidden\'].btn-size').length){var btn_size=form.find('.btn-size').val()}else{var btn_size=form.find('.btn-size:checked').val()};btn_size=btn_size?btn_size:'btn-md';if(btn_style==='btn btn-box-tool'){size_disabled=true};if(size_disabled){form.find('.btn-size').parent().each(function(){$(this).addClass('disabled').on('click',function(e){e.preventDefault();e.stopPropagation()})})}else{form.find('.btn-size').parent().each(function(){$(this).removeClass('disabled').unbind('click')})};var add_class=form.find('.btn-add-class').length?form.find('.btn-add-class').val():'';var all_class=btn_style+' '+btn_add_style+' '+btn_size+' '+add_class;all_class=all_class.replace(/\s{2,}/g,' ').trim();btn.attr('class',all_class);var input_type=form.find('.btn-input-type')?form.find('.btn-input-type').val():'';if(input_type){var input_name=form.find('.btn-input-name')?form.find('.btn-input-name').val():'';var btn_input_name=input_name?'name="'+input_name+'"':'';var input_value=form.find('.btn-input-value')?form.find('.btn-input-value').val():'';var btn_input_value=input_value?'value="'+input_value+'"':'';var btn_input='<input type="'+input_type+'" '+btn_input_name+' '+btn_input_value+' />'}else{var btn_input=''};var btn_icon=form.find('.load-icon')?form.find('.load-icon').html():'';var splitter=btn_icon&&btn_icon!=='<i class="fa"></i>'?' ':'';var toggle=btn.attr('data-toggle');if(toggle!=='dropdown'){if(form.find('.btn-tooltip:checked').val()){btn.attr('data-toggle','tooltip')}else{tooltipDestroy(btn);btn.attr('data-toggle','')}};var btn_title=form.find('.btn-title').val();btn.attr('title',btn_title);var btn_text=form.find('.btn-text').val().trim();var btn_icon_pos=form.find('.btn-icon-pos:checked').val();btn_icon_pos=btn_icon_pos?btn_icon_pos:'left';var input_icon_text='';if(btn_icon_pos=='right'){var input_icon_text=btn_input+btn_text+splitter+btn_icon}else{var input_icon_text=btn_input+btn_icon+splitter+btn_text};btn.html(input_icon_text.trim());tooltipRefresh();btn.addClass('form-open')}})};function formField(target_id,form_id){if($('.control-sidebar #'+form_id).length){$('.form-open').removeClass('form-open');initControllSidebar();return false};var field=$('#'+target_id);var form_group='';var input_group='';var label='';var html='';html+='<form class="form input-edit-form" target-id="'+target_id+'" id="'+form_id+'">';html+='<div class="box box-primary box-solid">';html+='<div class="box-header with-border">';html+=' <h3 class="box-title">РЕДАКТИРОВАНИЕ ПОЛЯ</h3>';html+=' <div class="box-tools pull-right">';html+='	 <button type="button" class="btn btn-box-tool pull-right" data-toggle="tooltip" title="Закрыть форму" onclick="$(this).closest(\'.form\').remove(); initControllSidebar(); tooltipRefresh();"><i class="fa fa-times"></i></button>';html+=' </div>';html+='</div>';if(field.length&&field.hasClass('multiselect')){$('.form-open').removeClass('form-open');html+='<div class="box-body">';html+=' <div class="callout callout-default">';html+='  <p><i class="fa fa-exclamation-triangle text-blue"></i> Фильтры-селекторы с мультивыбором настраиваются при редактировании фильтров! Здесь (в конструкторе) эти настройки нельзя изменить.</p>';html+=' </div>';html+='</div>'}else if(field.length&&!field.hasClass('multiselect')){html+='<div class="box-body bg-info">';var field_type=field[0].tagName.toLowerCase();var fieldClassList=field.attr('class')?field.attr('class').split(/\s+/):'';if(field.parent().hasClass('form-group')){form_group=field.parent()}else if(field.parent().parent().hasClass('form-group')){form_group=field.parent().parent()};var form_group_id='';var input_group_id='';var selected_el_id='';if(form_group.length){form_group_id=form_group.attr('id');if(!form_group_id){form_group_id=genPass('formgr_',5);form_group.attr('id',form_group_id)}};if(field.parent().hasClass('input-group')){input_group=field.parent()};if(input_group.length){input_group_id=input_group.attr('id');if(!input_group_id){input_group_id=genPass('ingr_',6);input_group.attr('id',input_group_id)}};$('.form-open').removeClass('form-open');var btn_remove_form_group='';var btn_remove_input_group='';var btn_remove_field='';if(form_group.length){btn_remove_form_group='<button type="button" class="btn btn-box-tool pull-right text-red" data-toggle="tooltip" title="Удалить форму с группой полей" onclick="removeElemByID(\''+form_group_id+'\');"><i class="fa fa-trash"></i></button>'}else if(input_group.length){btn_remove_input_group='<button type="button" class="btn btn-box-tool pull-right text-red" data-toggle="tooltip" title="Удалить группу полей" onclick="removeElemByID(\''+input_group_id+'\');"><i class="fa fa-trash"></i></button>'}else{btn_remove_field='<button type="button" class="btn btn-box-tool pull-right text-red" data-toggle="tooltip" title="Удалить поле" onclick="removeElemByID(\''+target_id+'\');"><i class="fa fa-trash"></i></button>'};if(form_group.length){html+='<div class="box box-primary">';html+=' <div class="box-header with-border">';html+='  <h3 class="box-title">Форма</h3>';html+='  <div class="box-tools pull-right">';html+='  <div class="btn-group btn-group-xs" data-toggle="buttons">';html+=btn_remove_form_group;html+='  </div>';html+='  </div>';html+=' </div>';html+=' <div class="box-body">';var label=form_group.find('> label');var label_text=label.length?label.text():'';html+=' <p>Метка</p>';html+='<div class="input-group input-group-sm"><input type="text" value="'+label_text+'" class="formgroup-label-text form-control" /><div class="input-group-btn"><label class="btn btn-default" data-toggle="tooltip" title="Очистить" onclick="$(this).closest(\'.input-group\').find(\'.formgroup-label-text\').val(\'\').trigger(\'change\');"><i class="fa fa-times-circle"></i></label></div></div>';html+=' <p></p>';html+=' </div>';html+='</div>'};if(input_group.length){html+='<div class="box box-primary">';html+=' <div class="box-header with-border">';html+='  <h3 class="box-title">Группа полей:</h3>';html+='  <div class="box-tools pull-right">';html+='  <div class="btn-group btn-group-xs" data-toggle="buttons">';html+=btn_remove_input_group;html+='</div>';html+='</div>';html+='</div>';html+='<div class="box-body">';var groupClassList=input_group.attr('class')?input_group.attr('class').split(/\s+/):[];var input_size_name=genPass('n_',4);html+=' <p>Размер</p>';html+='<div class="btn-group btn-group-xs btn-group-justified" data-toggle="buttons">';var sizeList={};sizeList['small']='input-group-sm';sizeList['middle']='input-group-md';sizeList['large']='input-group-lg';var group_size='';$.each(sizeList,function(ii,cl){if(groupClassList.in_array(cl.trim())){group_size=cl.trim()}});group_size=group_size?group_size:'input-group-md';$.each(sizeList,function(index,size){if(group_size==size){html+=' <label class="btn btn-primary active" data-toggle="tooltip" title="'+index+'"><input type="radio" class="inputgroup-size" name="'+input_size_name+'" value="'+size+'" checked="checked"/>'+index+'</label>'}else{html+='<label class="btn btn-primary" data-toggle="tooltip" title="'+index+'"><input type="radio" class="inputgroup-size" name="'+input_size_name+'" value="'+size+'"/>'+index+'</label>'}});html+='</div>';var excludeList='input-group input-group-sm input-group-md input-group-lg'.split(/\s+/);var add_class='';$.each(groupClassList,function(i,cl){var clas=cl.trim();if(!excludeList.in_array(clas)){add_class+=clas+' '}});html+=' <p></p>';html+=' <p>Класс(ы) группы</p>';html+='<div class="form-group valid-block">';html+='<div class="input-group input-group-sm"><input type="text" value="'+delDoubleSpaces(add_class)+'" class="inputgroup-add-class form-control field-input validclass" placeholder="class..." /><div class="input-group-btn"><label class="btn btn-default" data-toggle="tooltip" title="Очистить" onclick="$(this).closest(\'.input-group\').find(\'.inputgroup-add-class\').val(\'\').trigger(\'change\');"><i class="fa fa-times-circle"></i></label></div></div>';html+='</div>';html+=' </div>';html+='</div>'};html+='<div class="box box-primary">';html+=' <div class="box-header with-border">';html+='  <h3 class="box-title">ID поля: '+target_id+'</h3>';html+='  <div class="box-tools pull-right">';html+='  <div class="btn-group btn-group-xs" data-toggle="buttons">';var filter_input=null;if(field.hasAttr('filter_Input')){var filter_input=field};if(filter_input&&filter_input.length){var reload=filter_input.attr('filterReload')=='1'?1:0;var active_reload='text-red';var check_reload='';if(reload){active_reload='active text-green';check_reload='checked="checked"'};html+=' <label class="btn btn-box-tool check-control '+active_reload+'" data-toggle="tooltip" title="Применять фильтр немедленно"><input type="checkbox" class="filterReload" '+check_reload+'/><i class="fa fa-filter"></i></label>'};html+=btn_remove_field;html+='</div>';html+='</div>';html+='</div>';var inputClassList=field.attr('class')?field.attr('class').split(/\s+/):[];html+='<div class="box-body">';if(!input_group.length){var input_size_name=genPass('n_',4);html+=' <p>Размер поля</p>';html+='<div class="btn-group btn-group-xs btn-group-justified" data-toggle="buttons">';var inputSizeList={};inputSizeList['small']='input-sm';inputSizeList['middle']='input-md';inputSizeList['large']='input-lg';var input_size='';$.each(inputSizeList,function(ii,cl){if(inputClassList.in_array(cl.trim())){input_size=cl.trim()}});input_size=input_size?input_size:'input-md';$.each(inputSizeList,function(index,size){if(input_size==size){html+=' <label class="btn btn-primary active" data-toggle="tooltip" title="'+index+'"><input type="radio" class="input-size" name="'+input_size_name+'" value="'+size+'" checked="checked"/>'+index+'</label>'}else{html+='<label class="btn btn-primary" data-toggle="tooltip" title="'+index+'"><input type="radio" class="input-size" name="'+input_size_name+'" value="'+size+'"/>'+index+'</label>'}});html+='</div>'};var excludeList='input-sm input-md input-lg'.split(/\s+/);var addclass='';$.each(inputClassList,function(i,cl){var clas=cl.trim();if(!excludeList.in_array(clas)){addclass+=clas+' '}});html+=' <p></p>';html+=' <p>Класс(ы) поля</p>';html+='<div class="form-group valid-block">';html+='<div class="input-group input-group-sm"><input type="text" value="'+delDoubleSpaces(addclass)+'" class="input-add-class form-control field-input validclass" placeholder="class..." /><div class="input-group-btn"><label class="btn btn-default" data-toggle="tooltip" title="Очистить" onclick="$(this).closest(\'.input-group\').find(\'.input-add-class\').val(\'\').trigger(\'change\');"><i class="fa fa-times-circle"></i></label></div></div>';html+='</div>';var rows='';if(field_type=='textarea'){rows=field.attr('rows');html+='<div class="form-group valid-block">';html+='<div class="input-group input-group-sm"><div class="input-group-addon" data-toggle="tooltip" title="Количество рядов текстового поля (атрибут rows)">Rows:</div><input type="text" value="'+rows+'" class="textarea-rows form-control field-input digit"/><div class="input-group-btn"><label class="btn btn-default" data-toggle="tooltip" title="Очистить" onclick="$(this).closest(\'.input-group\').find(\'.textarea-rows\').val(\'\').trigger(\'change\');"><i class="fa fa-times-circle"></i></label></div></div>';html+='</div>'};html+=' </div>';html+='</div>';html+='</div>'};html+='</div>';html+='</form>';if(form_group.length){form_group.addClass('form-open')}else if(input_group.length){input_group.addClass('form-open')}else{field.addClass('form-open')};return html};function formFieldChange(){$(document).delegate('.input-edit-form','change',function(){var target_id=$(this).attr('target-id');var form=$(this);var field=$('#'+target_id);if(field.length){var form_id='form_'+target_id;if(!window.validation.isValid({container:'#'+form_id})){return false};var form_group='';var input_group='';var label='';if(field.parent().hasClass('form-group')){form_group=field.parent()}else if(field.parent().parent().hasClass('form-group')){form_group=field.parent().parent()};if(form_group.length){var label_text=form.find('.formgroup-label-text').val();label_text=label_text?label_text:'';if(label_text){form_group.find('label').remove();form_group.prepend('<label class="control-label">'+label_text+'</label>')}else{form_group.find('label').remove()}};if(field.parent().hasClass('input-group')){input_group=field.parent()};if(input_group.length){var filter_input=input_group.find('[filter_Input]');if(filter_input.length){var reload=form.find('.filterReload').prop('checked')?'1':'0';filter_input.attr('filterReload',reload)};var size=form.find('.inputgroup-size:checked').val();size=size?size:'input-group-md';var add_class=form.find('.inputgroup-add-class').val();add_class=add_class?add_class:'';var all_class='input-group '+size+' '+add_class;input_group.attr('class',delDoubleSpaces(all_class))};if(!input_group.length){var size=form.find('.input-size:checked').val();size=size?size:'input-md';var add_class=form.find('.input-add-class').val();add_class=add_class?add_class:'';var all_class=size+' '+add_class;field.attr('class',delDoubleSpaces(all_class))};var field_type=field[0].tagName.toLowerCase();if(field_type=='textarea'){var rows=form.find('.textarea-rows').val();rows=rows?rows:'';field.attr('rows',rows)};tooltipRefresh()}})};function sortColElem(){if(!$('#editor').hasClass('sortColElem-mode')){initControllSidebar()};initEdit(cur_mode='sortColElem');$('#editor .col, #elements-preview .col').attr('dropColElem',true);$('[dropColElem]').each(function(){if($(this).closest('[data-orderTPL]').length){$(this).removeAttr('dropColElem')}});$('[dropColElem] > *:not(.box)').each(function(){$(this).attr('sortableElem',true);$(this).find('select').prop('disabled',true);$(this).click(function(e){e.preventDefault();e.stopPropagation()})});var dropElSelector='[dropColElem]';var param={};param['group']={};param['group']['name']='colElem';param['ghostClass']='sortable-elem';sortableStartGroup(dropElSelector,param);sidebarClose();elementsOpen()};function sortTools(){if(!$('#editor').hasClass('sortTools-mode')){initControllSidebar()};initEdit(cur_mode='sortTools');$('#editor .box-tools, #elements-preview .box-tools').attr('dropToolsElem',true);$('[dropToolsElem]').each(function(){if($(this).closest('[data-orderTPL]').length){$(this).removeAttr('dropToolsElem')}});$('[dropToolsElem] > *').each(function(){$(this).attr('sortableElem',true);$(this).find('select').prop('disabled',true)});var dropElSelector='[dropToolsElem]';var param={};param['group']={};param['group']['name']='toolsElem';param['ghostClass']='sortable-elem';sortableStartGroup(dropElSelector,param);sidebarClose();elementsOpen()};function sortBtnGroupElem(){if(!$('#editor').hasClass('btngroup-mode')){initControllSidebar()};initEdit(cur_mode='btngroup');$('#editor .btn-group:not(.btn-group-input, [multiselectBtnGroup]), #editor .btn-group-vertical:not(.btn-group-input [multiselectBtnGroup]), #elements-preview .btn-group:not(.btn-group-input [multiselectBtnGroup]), #elements-preview .btn-group-vertical:not(.btn-group-input [multiselectBtnGroup])').attr('dropBtnGroupElem',true);$('[dropBtnGroupElem]').each(function(){if($(this).closest('[data-orderTPL]').length){$(this).removeAttr('dropBtnGroupElem')}});$('[dropBtnGroupElem] > *').each(function(){$(this).attr('sortableElem',true);$(this).click(function(e){e.preventDefault();e.stopPropagation()})});var dropElSelector='[dropBtnGroupElem]';var param={};param['group']={};param['group']['name']='btnGroupElem';param['ghostClass']='sortable-elem';sortableStartGroup(dropElSelector,param);$('#editor .input-group:not(.ms-reset-group, .ms-filter-group), #elements-preview .input-group:not(.ms-reset-group, .ms-filter-group)').attr('dropInputGroupElem',true);$('[dropInputGroupElem]').each(function(){if($(this).closest('[data-orderTPL]').length||$(this).find('> *:not([btnToggleDpGroup])').length<2){$(this).removeAttr('dropInputGroupElem')}});$('[dropInputGroupElem] > *:not([btnToggleDpGroup]').each(function(){$(this).attr('sortableElem',true);$(this).click(function(e){e.preventDefault();e.stopPropagation()})});var dropElSelector='[dropInputGroupElem]';var param={};param['filter']='[btnToggleDpGroup]';param['ghostClass']='sortable-elem';sortableStartGroup(dropElSelector,param);sidebarClose();elementsOpen()};function editBoxToosElem(){if(!$('#editor').hasClass('btn-mode')){initControllSidebar()};initEdit(cur_mode='btn');$('.btn:not(.edit-form-open, .btn-toggle-dp, .multiselect, .ms-reset-btn, .multiselect-clear-filter)').each(function(){if(!$(this).closest('[data-orderTPL]').length){if($(this).closest('#editor').length||$(this).closest('#elements-preview').length){$(this).attr('editedElem',true);$(this).click(function(e){e.preventDefault();e.stopPropagation();hideBtnIcons();var target_id=$(this).attr('id');if(!target_id){var target_id=genPass('btn_',8);$(this).attr('id',target_id)};var form_id='form'+target_id;var html=formBtn(target_id,form_id);if(html){$('.control-sidebar').html(html);tooltipRefresh();tooltipDestroy($(this));startValidation(form_id)}})}}});formBtnChange();$('input[type="text"], select, textarea, [filterinputgroup] .btn.multiselect').each(function(){if(!$(this).closest('[data-orderTPL]').length){if($(this).closest('#editor').length||$(this).closest('#elements-preview').length){$(this).attr('editedElem',true);if($(this).hasClass('dropdown-toggle')){var actions='mousedown, click'}else{var actions='mousedown'};$(this).on(actions,function(e){e.preventDefault();e.stopPropagation();hideBtnIcons();var target_id=$(this).attr('id');if(!target_id){var target_id=genPass('field_',6);$(this).attr('id',target_id)}var form_id='form'+target_id;var html=formField(target_id,form_id);if(html){$('.control-sidebar').html(html);tooltipRefresh();startValidation(form_id)}})}}});formFieldChange();sidebarOpen();elementsClose()};function hideBtnIcons(){var target=$('#'+$('.form .load-icon').attr('data-target-id'));if(target&&target.find('#btn_icons')&&target.find('#btn_icons >*').length){$('#hidden_icons').append(target.find('#btn_icons'))}};$(document).delegate('.form .load-icon','click',function(){var target=$('#'+$(this).attr('data-target-id'));if(target&&!target.find('#btn_icons >*').length){target.append($(document).find('#btn_icons'));target.slideDown()}else{target.slideToggle()}});$(document).delegate('.form .btn-icon-source','click',function(){var form=$(this).closest('.form');form.find($('.load-icon')).html($(this).html());form.trigger('change')});$(document).delegate('.form .btn-id, .form .btn-add-class, .form .btn-title, .form .btn-text, .form .header-title, .form .header-subtitle, .form .formgroup-label-text','keyup',function(e){$(this).closest('.form').trigger('change')});function removeElemByID(id){var elem=$('#'+id);if(elem.parent().hasClass('btn-group-input')){elem=elem.parent()};if(elem.length){elem.remove();initControllSidebar();tooltipRefresh()}};$(document).delegate('.remove-btn','click',function(e){var target_id=$(this).attr('target-id');var btn=$('#'+target_id);if(btn.parent().hasClass('btn-group')||btn.parent().hasClass('btn-group-vertical')||btn.parent().hasAttr('filterbtncleargroup')){var btn_group=btn.parent();btn.remove();if(!btn_group.html().trim().length){btn_group.remove()}}else{btn.remove()};initControllSidebar();tooltipRefresh()});$(document).delegate('.remove-btn-group','click',function(e){$('#'+$(this).attr('target-id')).remove();initControllSidebar();tooltipRefresh()});$(document).delegate('.remove-row','click',function(){$(this).closest('.row').remove();initControllSidebar();editBlocks();tooltipRefresh()});