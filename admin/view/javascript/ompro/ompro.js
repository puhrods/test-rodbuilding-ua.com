"use strict";(function(parentObject){parentObject.validation={_defaultOptions:{container:'',fieldSelector:'.field-input',validBlock:'.valid-block',liveCheck:true,submitSelector:'.save-button',submitHandler:null,errorClass:'input-error',okClass:'input-ok',errorText:{'validid':function(str){return'Поле обязательно! ID должен быть уникальным и начинаться с буквы. Используется латиница, цифры, знак дефиса и подчеркивание, без пробелов.'},'unique_option_value':function(str){return'Значение обязательно и должно быть уникальным. Используется латиница, цифры и нижнее подчеркивание, без пробелов.'},'unique_order_column':function(str){return'Название поля обязательно, должно быть уникальным и начинаться с буквы. Используется латиница, цифры и нижнее подчеркивание, без пробелов.'},'unique_field_key':function(str){return'Поле обязательно! Название должно быть уникальным во всём запросе и начинаться с буквы. Используется латиница, цифры и нижнее подчеркивание, без пробелов.'},'unique_product_column':function(str){return'Поле обязательно! Название должно быть уникальным (во всём запросе) и начинаться с буквы. Используется латиница, цифры и нижнее подчеркивание, без пробелов.'},'validtargetid':function(str){return'Нет такого ID, или ошибка в названии!'},'validclass':function(str){return'Имя класса должно начинаться с буквы. Используется латиница, цифры, знак дефиса и подчеркивание. Минимум 2 символа'},'validtargetclass':function(str){return'Нет такого класса, или ошибка в названии!'},'mustbe':function(str){return'Поле обязательно и не должно быть пустым!'},'coords':function(str){return'Неправильный формат координат! Пример: 55.750358, 37.611149'},'length32':function(str){return'Должно быть 32 символа!'},'numeric':function(str){return'Вводите только числа!'},'numericmustbe':function(str){return'Вводите только числа, поле обязательно!'},'notcyrillics':function(str){return'Кириллические символы недопустимы!'},'notcyrillicsmustbe':function(str){return'Кириллические символы недопустимы и поле не должно быть пустым!'},'sqlwithexclude':function(str){return'Недопустимый символ или команда и поле не должно быть пустым!'},'alpha':function(str){return'Вводите только буквы!'},'alphanumeric':function(str){return'Вводите только буквы и цифры!'},'validrgbcolor':function(str){return'Вводите только латинские буквы и цифры, всего 6 знаков!'},'date':function(str){return'Неправильный формат даты!'},'datetime':function(str){return'Неправильный формат даты, времени!'},'time':function(str){return'Неправильный формат времени!'},'digit':function(str){return'Вводите тольк цифры!'},'digitovercoma':function(str){return'Вводите только числа через завятую без пробелов! Поле не должно быть пустым!'},'numericoverdoubledot':function(str){return'Введите пару чисел через двоеточие без пробелов! Поле не должно быть пустым!'},'digitovercomanotmustbe':function(str){return'Вводите только числа через завятую без пробелов, или оставьте пустым!'},'digitmustbe':function(str){return'Вводите тольк цифры! Поле не должно быть пустым!'},'password':function(str){return'Недопустимые символы!'},'email':function(str){return'Неправильный формат email!'},'emailmusbe':function(str){return'Неправильный формат email и поле не должно быть пустым!'},'url':function(str){return'Неправильный формат ссылки!'},},validators:{'unique_option_value':function(str){var regExp=new RegExp('[\\s]');if(regExp.test(str)){return false};var regExp=new RegExp('[а-яА-ЯёЁ\\s]+$');if(regExp.test(str)){return false};var regExp=/[a-z0-9_]/i;if(!regExp.test(str)){return false};var i=0;$('body').find('.option-value').each(function(){if(this.value&&this.value===str){i++}});if(i>1){return false};return str.length>0},'unique_order_column':function(str){var regExp=new RegExp('[\\s]');if(regExp.test(str)){return false};var regExp=new RegExp('[а-яА-ЯёЁ\\s]+$');if(regExp.test(str)){return false};var regExp=/^[a-z_]\w+$/i;if(!regExp.test(str)){return false};var i=0;$('body').find('.order-key').each(function(){if(this.value&&this.value===str){i++}});if(i>1){return false};return str.length>0},'unique_field_key':function(str){var regExp=new RegExp('[\\s]');if(regExp.test(str)){return false};var regExp=new RegExp('[а-яА-ЯёЁ\\s]+$');if(regExp.test(str)){return false};var regExp=/^[a-z](\.|\w)\w+$/i;if(!regExp.test(str)){return false};var check_keys=$('body').find('#check_keys').val().split(/\s+/);if(check_keys.in_array(str)){return false};var i=0;$('body').find('.field-key').each(function(){if(this.value&&this.value===str){i++}});if(i>1){return false};return str.length>0},'unique_product_column':function(str){var regExp=new RegExp('[\\s]');if(regExp.test(str)){return false};var regExp=new RegExp('[а-яА-ЯёЁ\\s]+$');if(regExp.test(str)){return false};var regExp=/^[a-z_]\w+$/i;if(!regExp.test(str)){return false};var i=0;$('body').find('.product-key').each(function(){if(this.value&&this.value===str){i++}});if(i>1){return false};return str.length>0},'validid':function(str){var regExp=new RegExp('[\\s]');if(regExp.test(str)){return false};var regExp=new RegExp('[а-яА-ЯёЁ\\s]+$');if(regExp.test(str)){return false};var regExp=/^[a-z]\w|\-+$/i;if(!regExp.test(str)){return false};var i=0;$('body').find('[id]').each(function(){if(this.id&&this.id===str){i++}});if(i>1){return false}return str.length>0},'validtargetid':function(str){var regExp=new RegExp('[\\s]');if(regExp.test(str)){return false};var regExp=new RegExp('[а-яА-ЯёЁ\\s]+$');if(regExp.test(str)){return false};var regExp=/^[a-z]\w|\-+$/i;if(!regExp.test(str)){return false};var i=0;$('body').find('[id]').each(function(){if(this.id&&this.id===str){i++}});if(i<1){return false}return true},'validclass':function(str){var regExp=new RegExp('[а-яА-ЯёЁ]+$');if(regExp.test(str)){return false};var regExp=/^[a-z]\w|\-+$/i;if(str.length&&!regExp.test(str)){return false};var cl_test=true,strList=str.split(/\s+/);$.each(strList,function(i,cl){var clas=cl.trim();if(clas.length&&!regExp.test(clas)){cl_test=false;return false}});if(!cl_test){return false};return true},'validtargetclass':function(str){var regExp=new RegExp('[а-яА-ЯёЁ]+$');if(regExp.test(str)){return false};var regExp=/^[a-z]\w|\-+$/i;if(str.length&&!regExp.test(str)){return false};var cl_test=true,strList=str.split(/\s+/);var all_classes='';$('body').find('[class]').each(function(){if($(this).attr('class')){all_classes+=$(this).attr('class')+' '}});all_classes=all_classes.split(/\s+/);$.each(strList,function(i,cl){var clas=cl.trim();if(clas.length&&!regExp.test(clas)){cl_test=false;return false};if(!all_classes.in_array(clas)){cl_test=false;return false}});if(!cl_test){return false};return str.length>0},'mustbe':function(str){return str.trim().length>0},'coords':function(str){var regExp=new RegExp('(^\\d+\\.\\d+,\\s?\\d+\\.\\d+)$');return regExp.test(str)||!str},'length32':function(str){return str.length==32},'numeric':function(str){var regExp=new RegExp('^(([1-9])+([0-9])*)*$');return regExp.test(str)||!str},'numericmustbe':function(str){if(str.trim().length<1){return false};var regExp=new RegExp('^(([1-9])+([0-9])*)*$');return regExp.test(str)||!str},'notcyrillics':function(str){var regExp=new RegExp('[а-яА-ЯёЁ№]+');return!regExp.test(str)||!str},'notcyrillicsmustbe':function(str){var regExp=new RegExp('[а-яА-ЯёЁ№]+');if(regExp.test(str)){return false};return str.trim().length>0},'sqlwithexclude':function(str){var regExp=new RegExp(/(\s|^)(SELECT\s+INTO|UPDATE|REPLACE|INSERT|DELETE|CREATE|ALTER|DROP|TRUNCATE)\s|[а-яё№]+/i);if(regExp.test(str)){return false};return str.trim().length>0},'alpha':function(str){var regExp=new RegExp('^[а-яА-ЯёЁa-zA-Z\\s]+$');return regExp.test(str)||!str},'alphanumeric':function(str){var regExp=new RegExp('^[а-яА-ЯёЁa-zA-Z0-9\\s]+$');return regExp.test(str)||!str},'validrgbcolor':function(str){if(str.length!=6){return false};var regExp=new RegExp('^[a-zA-Z0-9\\s]+$');return regExp.test(str)},'date':function(str){var regExpISO=new RegExp('(19|20)\\d\\d-((0[1-9]|1[012])-(0[1-9]|[12]\\d)|(0[13-9]|1[012])-30|(0[13578]|1[02])-31)'),regExpRU=new RegExp('((0[1-9]|[12]\\d)\\.(0[1-9]|1[012])|30\\.(0[13-9]|1[012])|31\\.(0[13578]|1[02]))\\.(19|20)\\d\\d');return(regExpISO.test(str)|regExpRU.test(str))||!str},'datetime':function(str){var regExpISO=new RegExp('(19|20)\\d\\d-((0[1-9]|1[012])-(0[1-9]|[12]\\d)|(0[13-9]|1[012])-30|(0[13578]|1[02])-31) (\\d+):(\\d+)'),regExpRU=new RegExp('((0[1-9]|[12]\\d)\\.(0[1-9]|1[012])|30\\.(0[13-9]|1[012])|31\\.(0[13578]|1[02]))\\.(19|20)\\d\\d (\\d+):(\\d+)');return(regExpISO.test(str)|regExpRU.test(str))||!str},'time':function(str){var regExp=new RegExp('(\\d+):(\\d+)');return regExp.test(str)||!str},'digit':function(str){var regExp=new RegExp('^[0-9]+$');return regExp.test(str)||!str},'digitovercoma':function(str){if(str.trim().length<1){return false};var regExp=new RegExp('^(([1-9])+([0-9])*)+(,([1-9])+([0-9])*)*$');return regExp.test(str)||!str},'numericoverdoubledot':function(str){if(str.trim().length<1){return false};var regExp=new RegExp('^((([1-9])+([0-9])*)+(:([1-9])+([0-9])*))?$');return regExp.test(str)||!str},'digitovercomanotmustbe':function(str){var regExp=new RegExp('^(([1-9])+([0-9])*)+(,([1-9])+([0-9])*)*$');return regExp.test(str)||!str},'digitmustbe':function(str){if(str.trim().length<1){return false};var regExp=new RegExp('^[0-9]+$');return regExp.test(str)||!str},'password':function(str){var regExp=new RegExp('^[а-яА-ЯёЁa-zA-Z0-9\\s]+$');return regExp.test(str)||!str},'email':function(str){var regExp=new RegExp('^([a-z0-9_-]+\\.)*[a-z0-9_-]+@[a-z0-9_-]+(\\.[a-z0-9_-]+)*\\.[a-z]{2,6}$');return regExp.test(str)||!str},'emailmusbe':function(str){if(str.trim().length<1){return false};var regExp=new RegExp('^([a-z0-9_-]+\\.)*[a-z0-9_-]+@[a-z0-9_-]+(\\.[a-z0-9_-]+)*\\.[a-z]{2,6}$');return regExp.test(str)||!str},'url':function(str){var regExp=new RegExp('^((https?|ftp)\\:\\/\\/)?([a-z0-9]{1})((\\.[a-z0-9-])|([a-z0-9-]))*\\.([a-z]{2,6})(\\/?)$');return regExp.test(str)||!str}}},init:function(_options){var options=$.extend({},this._defaultOptions,(_options||{})),self=this;if(options.container&&options.fieldSelector){if(options.submitSelector){$(options.container).find(options.submitSelector).on('click',function(){if(self.isValid(options)){if(typeof(options.submitHandler)==='function')options.submitHandler();return true}else{return false}})};if(options.liveCheck){$(options.container).find(options.fieldSelector).each(function(cnt,item){$(item).on('click',function(){self.validItem($(item),options)}).on('blur',function(){self.validItem($(item),options)}).on('change',function(){self.validItem($(item),options)}).on('keyup',function(){self.validItem($(item),options)})})}}},validItem:function(item,_options){var options=$.extend({},this._defaultOptions,(_options||{})),classList=$(item).attr('class').split(/\s+/),validResult=true;var error_toastr='';$.each(classList,function(index,cl){if(cl==='confirmfield'){validResult&=($(options.container).find('[Name="'+$(item).attr('confirm-field')+'"]').val()==$(item).val())}else if(typeof(options.validators[cl])==='function'){validResult&=options.validators[cl](item.val());error_toastr=options.errorText[cl](item.val());if($(item).closest(options.validBlock)&&!$(item).closest(options.validBlock).find('.error-span').length){$(item).closest(options.validBlock).append('<span class="error-span">'+options.errorText[cl](item.val())+'</span>')}}});if(!validResult){$(item).addClass(options.errorClass).removeClass(options.okClass);if($(item).closest(options.validBlock)&&$(item).closest(options.validBlock).find('.error-span').length){$(item).closest(options.validBlock).find('.error-span').addClass('error-active');$('html, body').animate({scrollTop:item.offset().top},'slow')}else if(error_toastr){toastr.options.timeOut=3000;toastr.options.preventDuplicates=true;toastr.error(error_toastr,'Внимание!')}}else{$(item).addClass(options.okClass).removeClass(options.errorClass);if($(item).closest(options.validBlock)&&$(item).closest(options.validBlock).find('.error-span').length){$(item).closest(options.validBlock).find('.error-span').removeClass('error-active')};return validResult}},isValid:function(_options){var options=$.extend({},this._defaultOptions,(_options||{})),validResult=true,self=this;if(options.container&&options.fieldSelector){$(options.container).find(options.fieldSelector).each(function(cnt,item){validResult&=self.validItem($(item),options)})};return validResult},clear:function(_options){var options=$.extend(true,{},this._defaultOptions,(_options||{}));if(options.container&&options.fieldSelector){$(options.container).find(options.fieldSelector).removeClass(options.errorClass).removeClass(options.okClass)}}}})(window);jQuery.cachedScript=function(url,options){options=$.extend(options||{},{dataType:"script",cache:true,url:url});return jQuery.ajax(options)};function isValidDate(date){return date&&Object.prototype.toString.call(date)==="[object Date]"&&!isNaN(date)};function isFunction(functionToCheck){var getType={};return functionToCheck&&getType.toString.call(functionToCheck)==='[object Function]'};function utf8_to_b64(str){return window.btoa(unescape(encodeURIComponent(str)))};function b64_to_utf8(str){return decodeURIComponent(escape(window.atob(str)))};function getURLVar(key){var value=[];var query=document.location.search.split('?');if(query[1]){var part=query[1].split('&');for(i=0;i<part.length;i++){var data=part[i].split('=');if(data[0]&&data[1]){value[data[0]]=data[1]}}if(value[key]){return value[key]}else{return''}}};function numberFormat(num,decimals,dec_point,thousands_sep){var i,j,kw,kd,km;if(isNaN(decimals=Math.abs(decimals))){decimals=2}if(dec_point==undefined){dec_point=","}if(thousands_sep==undefined){thousands_sep="."}i=parseInt(num=(+num||0).toFixed(decimals))+"";kw=i.split(/(?=(?:\d{3})+$)/).join(thousands_sep);kd=(decimals?dec_point+Math.abs(num-i).toFixed(decimals).replace(/-/,0).slice(2):"");return kw+kd};function tooltipRefresh(parentSelector=''){$(parentSelector+' .tooltip').remove();$(parentSelector+' [data-toggle="tooltip"]').each(function(){$(this).tooltip({container:'body',trigger:'hover'})});$('.popover').remove();$(' [data-toggle="popover"]').each(function(){$(this).popover({placement:'auto left',trigger:'hover'})})};function controlCheckedInput(){$('.btn').each(function(){var btn=$(this),input=btn.find('input');if(!btn.closest('#tab_constructor').length){if(input.length&&input.attr('type')&&(input.attr('type')=='checkbox'||input.attr('type')=='radio')){$(document).delegate(input,'change',function(){if(btn.hasClass('active')){input.prop('checked',true)};setTimeout(function(){btn.removeClass('focus')},100)});input.trigger('change')}}})};function preventFunctionEditor(){if($('.template-form').length||$('.omanager-content').attr('id')=='editor'){toastr.options.preventDuplicates=true;toastr.warning('Некоторые действия при редактировании не доступны!','Внимание!');return true};return false};$.fn.hasAttr=function(name){return this.attr(name)!==undefined};function arrayUnique(array){var a=array.concat();for(var i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i]===a[j])a.splice(j--,1)}};return a};Array.prototype.in_array=function(p_val){for(var i=0,l=this.length;i<l;i++){if(this[i]==p_val){return true}};return false};$('[data-toggle="push-menu"]').click(function(){if(!$('body').hasClass('sidebar-collapse')){localStorage.setItem('sidebar-collapse','collapse')}else{localStorage.setItem('sidebar-collapse','')}});